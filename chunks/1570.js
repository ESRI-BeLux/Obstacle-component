"use strict";(self.webpackChunkobstacle_component=self.webpackChunkobstacle_component||[]).push([[1570],{51027:(e,t,i)=>{i.d(t,{M:()=>c,b:()=>h});var s=i(84614),r=i(63371),n=i(24603),a=i(23410),o=i(3961),l=i(21414);function h(e){const t=new o.kG,{vertex:i,fragment:h}=t;(0,s.Sv)(i,e),i.uniforms.add(new n.p("width",(e=>e.width))),t.attributes.add(l.T.POSITION,"vec3"),t.attributes.add(l.T.NORMAL,"vec3"),t.attributes.add(l.T.UV0,"vec2"),t.attributes.add(l.T.AUXPOS1,"float"),t.varyings.add("vtc","vec2"),t.varyings.add("vlength","float"),t.varyings.add("vradius","float"),i.code.add(a.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),h.uniforms.add([new n.p("outlineSize",(e=>e.outlineSize)),new r.N("outlineColor",(e=>e.outlineColor)),new n.p("stripeLength",(e=>e.stripeLength)),new r.N("stripeEvenColor",(e=>e.stripeEvenColor)),new r.N("stripeOddColor",(e=>e.stripeOddColor))]);const c=1/Math.sqrt(2);return h.code.add(a.H`
    const float INV_SQRT2 = ${a.H.float(c)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),t}const c=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},84572:(e,t,i)=>{i.d(t,{RN:()=>h,e9:()=>l,hU:()=>d,uu:()=>c});var s=i(30936),r=i(51366),n=i(46010);function a(e,t){const i=e.a*t;return(0,n.EX)(e)>225?new s.Z([0,0,0,i]):new s.Z([255,255,255,i])}function o(e,t){const i=new s.Z(e);return i.a*=t,i}function l(e=1){return o(r.Z.analysisTheme.accentColor,e)}function h(e=1){return a(l(),e)}function c(e=1){return o(r.Z.analysisTheme.textColor,e)}function d(e=1){return a(c(),e)}},71197:(e,t,i)=>{i.d(t,{Y:()=>r});var s=i(17321);const r={readOnly:!0,get(){return(0,s.RG)(this.view)}}},83772:(e,t,i)=>{i.d(t,{BK:()=>m,Jn:()=>o,RL:()=>l,VW:()=>a,W_:()=>_,jG:()=>p,tq:()=>u,vQ:()=>h,zx:()=>c});var s=i(61681),r=i(91478);function n(e){return e?p:g}function a(e,t){return function(e,t){return(0,s.Wi)(t)||!t.mode?n(e).mode:t.mode}(!!(0,s.pC)(e)&&e.hasZ,t)}function o(e,t){return function(e,t){return(0,s.pC)(t)?t:n(e)}(!!(0,s.pC)(e)&&e.hasZ,t)}function l(e){const t=function(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}(e),i=a(e.geometry,t);return{mode:i,offset:(0,s.pC)(t)&&"on-the-ground"!==i?(0,s.Pt)(t.offset,0)*(0,r.Z7)((0,s.Pt)(t.unit,"meters")):0}}function h(e,t,i,s=null){return d(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,s)}function c(e,t,i,s,r=null){return d(e,t[0],t[1],t.length>2?t[2]:0,i,s,r)}function d(e,t,i,r,n,a,o=null){if((0,s.Wi)(a))return;const l=(0,s.pC)(o)?o.mode:"absolute-height";if("on-the-ground"===l)return 0;const{absoluteZ:h}=u(t,i,r,n,e,a);return function(e,t,i,r,n,a,o,l){const h=(0,s.pC)(o)&&(0,s.pC)(o.offset)?o.offset:0;switch(l){case"absolute-height":return e-h;case"relative-to-ground":return e-((0,s.Pt)(a.elevationProvider.getElevation(t,i,r,n,"ground"),0)+h);case"relative-to-scene":return e-((0,s.Pt)(a.elevationProvider.getElevation(t,i,r,n,"scene"),0)+h)}}(h,t,i,r,n,e,o,l)}function u(e,t,i,r,n,a){const o=(0,s.pC)(a.offset)?a.offset:0;switch(a.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const i=(0,s.Pt)(n.elevationProvider.getElevation(e,t,0,r,"ground"),0);return{absoluteZ:i,elevation:i}}case"relative-to-ground":{const a=(0,s.Pt)(n.elevationProvider.getElevation(e,t,i,r,"ground"),0);return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=(0,s.Pt)(n.elevationProvider.getElevation(e,t,i,r,"scene"),0);return{absoluteZ:i+a+o,elevation:a}}}}function _(e,t){if((0,s.Wi)(t))return!1;const{mode:i}=t;return(0,s.pC)(i)&&("scene"===e&&"relative-to-scene"===i||"ground"===e&&"absolute-height"!==i)}const p={mode:"absolute-height",offset:0},g={mode:"on-the-ground",offset:null};function m(e,t){return e===t||(0,s.pC)(e)&&(0,s.pC)(t)&&e.mode===t.mode&&e.offset===t.offset}},60573:(e,t,i)=>{i.d(t,{p:()=>h});var s=i(36663),r=i(23148),n=i(61681),a=i(64189),o=i(81977),l=(i(7753),i(7283),i(40266));const h=e=>{let t=class extends((0,a.v)(e)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return!(0,n.pC)(this.parent)||this.parent.visible&&!this.parent.suspended}set visible(e){this._overrideIfSome("visible",e)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,r.kB)((()=>this._interactiveViewModelCount--))}};return(0,s._)([(0,o.Cb)({readOnly:!0})],t.prototype,"type",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0})],t.prototype,"analysis",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0})],t.prototype,"parent",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,s._)([(0,o.Cb)({type:Boolean})],t.prototype,"interactive",null),(0,s._)([(0,o.Cb)()],t.prototype,"_userInteractive",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,s._)([(0,o.Cb)()],t.prototype,"visible",null),(0,s._)([(0,o.Cb)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,s._)([(0,l.j)("esri.views.3d.analysis.AnalysisView3D")],t),t}},92121:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ue});var s=i(36663),r=i(53443),n=i(61681),a=i(81977),o=(i(7753),i(7283),i(40266)),l=i(71197),h=i(60573),c=i(76545),d=i(44584),u=i(13802),_=i(39405),p=i(76868),g=i(6766),m=i(8909),v=i(17700),y=i(90819),f=i(90472),b=i(25726),C=i(85130),w=i(28376),P=i(56331);const O="esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController",S=u.Z.getLogger(O);let E=class extends r.Z{constructor(e){super(e),this._unitNormalizer=new P.D,this._handles=new d.Z,this._tempStartPosition=(0,m.c)(),this._tempEndPosition=(0,m.c)(),this._tempCornerPosition=(0,m.c)()}initialize(){const e=this.view.spatialReference,t=(0,b.rS)(e),i=t===b.GG?b.wY:t;this._sphericalPCPF=i;const s=(0,f.Up)(e,i);this._unitNormalizer.spatialReference=s?i:e,this._handles.add([(0,p.YP)((()=>({viewData:this.viewData,startPoint:this.analysis.startPoint})),(({viewData:e,startPoint:t})=>{e.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(t)}),p.tX),(0,p.YP)((()=>({viewData:this.viewData,endPoint:this.analysis.endPoint})),(({viewData:e,endPoint:t})=>{e.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(t)}),p.tX),(0,p.YP)((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e}),p.tX)])}destroy(){this._handles=(0,n.SC)(this._handles)}_applyProjectionAndElevationAlignment(e){if((0,n.Wi)(e))return e;const t=(0,w.G)(e,this.view.spatialReference,this.view.elevationProvider);return(0,n.Wi)(t)?((0,w.e)(this.analysis,e.spatialReference,S),null):t}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if((0,n.Wi)(e)||(0,n.Wi)(t))return null;const s=this._euclideanDistances(e,t),r=this._geodesicDistance(e,t,s.horizontal.value),a=i===c.e.Geodesic||i===c.e.Auto&&s.horizontal.value>1e5?"geodesic":"euclidean";return{mode:a,distance:"euclidean"===a?s.direct:r,directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:r}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,r=this._tempEndPosition,n=this._tempCornerPosition,a=this.view.spatialReference,o=this._sphericalPCPF,l=(0,f.Up)(a,o)?o:a;(0,f.KC)(e,s,l),(0,f.KC)(t,r,l),(0,f.KC)(i,n,l);const h=(0,g.i)(s,r),c=(0,g.i)(n,r),d=Math.abs(t.z-e.z),u=e=>this._unitNormalizer.normalizeDistance(e),p=u(h),m=u(c),v=u(d);return{direct:(0,_.EV)(p,"meters"),horizontal:(0,_.EV)(m,"meters"),vertical:(0,_.EV)(v,"meters")}}_geodesicDistance(e,t,i){const s=e.spatialReference,r=new y.Z({spatialReference:s});r.addPath([e,t]);const a=s.isGeographic&&(0,C.Gb)(s)?(0,C.Jf)([r],"meters")[0]:s.isWebMercator?(0,v.geodesicLength)(r,"meters"):null,o=(0,n.pC)(a)?a:this._fallbackGeodesicDistance(e,t,i);return(0,_.EV)(o,"meters")}_fallbackGeodesicDistance(e,t,i){if((0,f.UY)(e,M)&&(0,f.UY)(t,L)){const e=new C._q;return(0,C.cA)(e,M,L),e.distance}return i}};(0,s._)([(0,a.Cb)()],E.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],E.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],E.prototype,"viewData",void 0),(0,s._)([(0,a.Cb)()],E.prototype,"_computedResult",null),E=(0,s._)([(0,o.j)(O)],E);const M=(0,m.c)(),L=(0,m.c)();var z,A,V,R=i(30936),D=(i(87090),i(84572)),T=i(19431),G=i(10145),x=i(95550),W=i(17321),j=i(55709);(V=z||(z={}))[V.None=0]="None",V[V.Direct=1]="Direct",V[V.Triangle=2]="Triangle",V[V.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(A||(A={}));var U=i(19570),Z=i(6941),N=i(37926),H=i(39100),F=i(1983),I=i(68817),q=i(10449),k=i(6087),B=i(7358),Y=i(44685),Q=i(35031),X=i(5079),K=i(46378),$=i(21414),J=i(9969),ee=i(52756),te=i(67197),ie=i(5474),se=i(12045),re=i(95194),ne=i(42842),ae=i(86942),oe=i(51027),le=i(91907),he=i(17346);class ce extends ee.A{constructor(e,t,i){super(e,t,i)}initializeProgram(e){return new re.$(e.rctx,ce.shader.get().build(this.configuration),ie.i)}_setPipelineState(e){const t=e===ne.A.NONE,i=this.configuration;return(0,he.sm)({blending:i.transparent?t?se.wu:(0,se.j7)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:le.wb.LESS},depthWrite:he.LZ,colorWrite:he.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return le.MX.TRIANGLE_STRIP}}ce.shader=new J.J(oe.M,(()=>i.e(827).then(i.bind(i,20827))));class de extends ae.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=ne.A.NONE}}(0,s._)([(0,te.o)()],de.prototype,"polygonOffsetEnabled",void 0),(0,s._)([(0,te.o)()],de.prototype,"transparent",void 0),(0,s._)([(0,te.o)({count:ne.A.COUNT})],de.prototype,"transparencyPassType",void 0);class ue extends B.F5{constructor(e){super(e,new pe),this._configuration=new de}getConfiguration(e,t){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration}dispose(){}intersect(){}requiresSlot(e,t){return t===Q.H.Color&&e===K.r.OPAQUE_MATERIAL}createGLMaterial(e){return new _e(e)}createBufferWriter(){return new Ce}}class _e extends X.Z{beginSlot(e){return this.ensureTechnique(ce,e)}}class pe extends B.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=(0,F.f)(1,.5,0,1),this.stripeEvenColor=(0,F.f)(1,1,1,1),this.stripeOddColor=(0,F.f)(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const ge=(0,Y.U$)().vec3f($.T.POSITION).vec3f($.T.NORMAL).vec2f($.T.UV0).f32($.T.AUXPOS1),me=(0,m.c)(),ve=(0,m.c)(),ye=(0,m.c)(),fe=(0,m.c)(),be=(0,m.c)();class Ce{constructor(){this.vertexBufferLayout=ge}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get($.T.POSITION).length/2+1)}write(e,t,i,s,r){const n=i.vertexAttributes.get($.T.POSITION).data,a=i.vertexAttributes.get($.T.NORMAL).data,o=n.length/3,l=i&&i.indices&&i.indices.get($.T.POSITION);l&&l.length!==2*(o-1)&&console.warn("MeasurementArrowMaterial does not support indices");const h=me,c=ve,d=ye,u=fe,_=be,p=s.position,m=s.normal,v=s.uv0;let y=0;for(let i=0;i<o;++i){const s=3*i;if((0,g.s)(h,n[s],n[s+1],n[s+2]),i<o-1){const e=3*(i+1);(0,g.s)(c,n[e],n[e+1],n[e+2]),(0,g.s)(_,a[e],a[e+1],a[e+2]),(0,g.n)(_,_),(0,g.b)(d,c,h),(0,g.n)(d,d),(0,g.f)(u,_,d),(0,g.n)(u,u)}const l=(0,g.i)(h,c);e&&t&&((0,g.m)(h,h,e),(0,g.m)(c,c,e),(0,g.m)(u,u,t));const f=r+2*i,b=f+1;p.setVec(f,h),p.setVec(b,h),m.setVec(f,u),m.setVec(b,u),v.set(f,0,y),v.set(f,1,-1),v.set(b,0,y),v.set(b,1,1),i<o-1&&(y+=l)}const f=s.auxpos1;for(let e=0;e<2*o;++e)f.set(r+e,y)}}class we extends q._{constructor(e){super(e),this._parameters={arrowWidth:16,arrowOutlineColor:R.Z.toUnitRGBA((0,D.e9)()),arrowStripeEvenColor:R.Z.toUnitRGBA((0,D.RN)()),arrowStripeOddColor:R.Z.toUnitRGBA((0,D.e9)()),arrowSubdivisions:128},this._handles=null,this._origin=(0,m.c)(),this._originTransform=(0,H.c)(),this._arrowCenter=(0,m.c)(),this._renderOccluded=B.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i}=this._parameters,s=(0,T.H)(Pe,this._stripesEnabled?t:i,e);this._arrowMaterial.setParameters({stripeEvenColor:s})}}get opacity(){return this._opacity}set opacity(e){e!==this._opacity&&(this._opacity=e,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:e,arrowStripeOddColor:t,arrowOutlineColor:i}=this._parameters,s=this._stripesEnabled?e:t;this._arrowMaterial=new ue({outlineColor:i,stripeEvenColor:s,stripeOddColor:t,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new d.Z,this._handles.add((0,p.YP)((()=>this.view.state.camera),(()=>{this._viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if((0,n.Wi)(this._geometry)||(0,n.Wi)(this._geometry.startRenderSpace)||(0,n.Wi)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(e,t,i,s){const r=this.view.renderCoordsHelper,n=[],a=[],o=(e,t)=>{const s=I.WM.get();(0,g.b)(s,e,i),n.push(s),a.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=I.WM.get();r.worldUpAtPosition(this._arrowCenter,i),o(e,i),o(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),n=I.WM.get(),a=I.WM.get();s.eval(i,n),r.worldUpAtPosition(n,a),o(n,a)}}return(0,k.rh)(n,a)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,n.pC)(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*e})}}_updateArrowOpacity(){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i,arrowOutlineColor:s}=this._parameters,r=(0,T.H)(Pe,this._stripesEnabled?t:i,e),n=(0,T.H)(Oe,s,e),a=(0,T.H)(Se,i,e);this._arrowMaterial.setParameters({stripeEvenColor:r,outlineColor:n,stripeOddColor:a})}}const Pe=(0,F.c)(),Oe=(0,F.c)(),Se=(0,F.c)();var Ee=i(83061),Me=i(60033),Le=i(66962),ze=i(8108),Ae=i(60720);let Ve=class extends r.Z{constructor(e){super(e),this._params={triangleColor:new Float32Array(R.Z.toUnitRGBA((0,D.e9)(.75))),triangleLineWidth:3,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:new Float32Array(R.Z.toUnitRGBA((0,D.e9)(.75))),guideLineWidth:2,guideStippleLengthPixels:6,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},this._handles=new d.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,m.c)(),this._endPosition=(0,m.c)(),this._cornerPosition=(0,m.c)(),this._startPositionAtSeaLevel=(0,m.c)(),this._endPositionAtSeaLevel=(0,m.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=A.Auto,this.triangleCollapseRatioThreshold=.03}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if((0,n.Wi)(e)||(0,n.Wi)(t)||e.equals(t))return z.None;const i=this.analysisView.result;if((0,n.Wi)(i))return z.Direct;if("geodesic"===i.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?z.ProjectedGeodesic:z.Direct;const{verticalDistance:s,horizontalDistance:r}=i,a=s.value,o=r.value;return Math.min(a/o,o/a)<this.triangleCollapseRatioThreshold?z.Direct:z.Triangle}get actualVisualizedMeasurement(){if((0,n.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case c.e.Auto:case c.e.Euclidean:default:return"euclidean";case c.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,n.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,n.Wi)(this._triangleOrientationOverride)!==e&&((0,n.Wi)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){const e="geodesic"===this.actualVisualizedMeasurement;return{direct:this._segmentLabel,horizontal:e?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}initialize(){const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new we({...t,geometry:null,renderOccluded:B.yD.OccludeAndTransparent}),this._triangleVisualElement=new N.r({...t,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:B.yD.OccludeAndTransparent}),this._rightAngleQuad=new Ee.R({...t,color:new Float32Array(R.Z.toUnitRGBA((0,D.e9)(.75))),renderOccluded:B.yD.OccludeAndTransparent});const i={...t,polygonOffset:!0,renderOccluded:B.yD.OccludeAndTransparent};this._projectedGeodesicLine=new N.r({...i,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Le.z5)(e.guideStippleLengthPixels)}),this._geodesicStartHint=new N.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Le.z5)(e.guideStippleLengthPixels)}),this._geodesicEndHint=new N.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Le.z5)(e.guideStippleLengthPixels)});const s={...t,backgroundColor:(0,D.hU)(.6),textColor:(0,D.uu)()};this._segmentLabel=new Z.Kc({...s,fontSize:e.direcLabelFontSize}),this._verticalLabel=new Z.Kc({...s,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new Z.Kc({...s,fontSize:e.horizontalLabelFontSize}),this._handles.add([(0,p.YP)((()=>{const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView,i=this.view;return{view:i,camera:i.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}}),(e=>this._updateGeometryAndViewMode(e)),p.tX),(0,p.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateVisualElementVisibility(e)),p.tX),(0,p.YP)((()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement})),(e=>this._updateLabelText(e)),p.tX),(0,p.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateLabelVisibility(e)),p.tX),(0,p.YP)((()=>this._measurementArrowStripeLength),(e=>this._updateSegmentStripeLength(e)),p.tX),(0,ze.qe)((async()=>this._updateMessageBundle()))]),this._updateMessageBundle()}destroy(){this._handles=(0,n.SC)(this._handles),this._segmentVisualElement=(0,n.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,n.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,n.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,n.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,n.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,n.SC)(this._geodesicEndHint),this._segmentLabel=(0,n.SC)(this._segmentLabel),this._verticalLabel=(0,n.SC)(this._verticalLabel),this._horizontalLabel=(0,n.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case z.None:break;case z.Direct:this._segmentVisualElement.visible=!0;break;case z.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case z.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,orientation:a,visualizedMeasurement:o,stripeLength:l}){const h=e.renderCoordsHelper;if((0,n.Wi)(h)||(0,n.Wi)(s)||(0,n.Wi)(r)||s.equals(r))return;let c=this._startPosition,d=this._endPosition;h.toRenderCoords(s,c),h.toRenderCoords(r,d);const u=a===A.AboveSegment?1:-1,_=u*(h.getAltitude(d)-h.getAltitude(c));_<0&&(c=this._endPosition,d=this._startPosition);const p="geodesic"===o?new Me.u(this._startPosition,this._endPosition,h.spatialReference):new Me.y(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=p,this._updateSegmentStripeLength(l),i){case z.Direct:this._updateSegment(p,a);break;case z.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:p,orientation:a,startPosition:c,endPosition:d,deltaSign:u,altitudeDelta:_});break;case z.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:a,startPosition:c,endPosition:d})}}_updateSegment(e,t){this._segmentLabel.anchor=t===A.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:s,startPosition:r,endPosition:n,deltaSign:a,altitudeDelta:o}){const l=this._cornerPosition;e.worldUpAtPosition(r,l),(0,g.g)(l,l,a*Math.abs(o)),(0,g.a)(l,l,r),this._triangleVisualElement.geometry=[[[r[0],r[1],r[2]],[l[0],l[1],l[2]],[n[0],n[1],n[2]]]],this._rightAngleQuad.geometry={previous:r,center:l,next:n};const h=new Me.y(r,l),c=new Me.y(l,n),d=function(e,t,i,s,r){const n=De,a=Te;r.projectToRenderScreen(i,n),r.projectToRenderScreen(t,a);const o={segment:"bottom",horizontal:"top",vertical:n[0]<a[0]?"left":"right"};{const s=Ge,n=xe;if((0,U.c)(e,i,s,r),(0,U.c)(e,t,n,r),(0,j.h)(s,n)>=Re){const e=Math.sign(s[1])===Math.sign(n[1]);o.segment=e?(0,Z.jB)(o.vertical):o.vertical}else{const e=We;(0,U.c)(i,t,e,r),(0,j.h)(e,n)>=Re&&(o.segment=Math.sign(e[0])===Math.sign(n[0])?(0,Z.jB)(o.horizontal):o.horizontal)}}if(s===A.BelowSegment){const e=e=>"top"===e?"bottom":"top";o.segment=e(o.segment),o.horizontal=e(o.horizontal),o.vertical=e(o.vertical)}return o}(r,n,l,s,t);this._segmentLabel.anchor=d.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=d.vertical,this._horizontalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._horizontalLabel.anchor=d.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:s}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,s);const r=new Me.u(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(r),this._geodesicStartHint.setGeometryFromSegment(new Me.y(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new Me.y(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},this._segmentLabel.anchor=t===A.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){(0,n.pC)(e)?(this._segmentLabel.text="euclidean"===t?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const i=this._segmentLabel,s=this._horizontalLabel,r=this._verticalLabel;if(i.visible=!1,s.visible=!1,r.visible=!1,e)switch(t){case z.Direct:i.visible=!0;break;case z.Triangle:i.visible=!0,s.visible=!0,r.visible=!0;break;case z.ProjectedGeodesic:i.visible=!0;case z.None:}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if((0,n.Wi)(t)||(0,n.Wi)(e))return null;const{directDistance:i,horizontalDistance:s,verticalDistance:r,geodesicDistance:a}=t,o=this.analysisView.unit,l=e=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(o){case"metric":return l({euclideanDistance:i&&(0,G.Rd)(e,i),geodesicDistance:a&&(0,G.Rd)(e,a),horizontalDistance:s&&(0,G.Rd)(e,s),verticalDistance:r&&(0,G.Wv)(e,r)});case"imperial":return l({euclideanDistance:i&&(0,G.Ud)(e,i),geodesicDistance:a&&(0,G.Ud)(e,a),horizontalDistance:s&&(0,G.Ud)(e,s),verticalDistance:r&&(0,G.Zv)(e,r)});default:return l({euclideanDistance:i&&(0,G.VG)(e,i,o),geodesicDistance:a&&(0,G.VG)(e,a,o),horizontalDistance:s&&(0,G.VG)(e,s,o),verticalDistance:r&&(0,G.VG)(e,r,o)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;(0,n.pC)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,n.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===A.Auto?this.view.state.camera.aboveGround?A.AboveSegment:A.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(!t?.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,r=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/r>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if((0,n.Wi)(e))return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&(0,_.nn)(s,"meters");break;case"imperial":i=s&&(0,_.nn)(s,(0,W.FN)(s.value,s.unit));break;default:i=s&&(0,_.nn)(s,t)}return(0,n.Wi)(i)?null:(0,T.sk)(i.value/30)*(0,W.En)(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,Ae.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})).finally((()=>{this.loadingMessages=!1}))}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement?.stripeLength}}};(0,s._)([(0,a.Cb)()],Ve.prototype,"_triangleOrientationOverride",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"messages",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"analysisView",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"loadingMessages",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"visible",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"viewMode",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"visualElementOrientation",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"triangleCollapseRatioThreshold",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"labels",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"_labelsText",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"_actualVisualElementsOrientation",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"_measurementArrowStripeLength",null),Ve=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],Ve);const Re=Math.cos((0,T.Vl)(12)),De=(0,x.J$)(),Te=(0,x.J$)(),Ge=(0,x.gX)(),xe=(0,x.gX)(),We=(0,x.gX)();let je=class extends((0,h.p)(r.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=c.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new Ve({view:e,analysis:t,analysisView:this}),this._analysisController=new E({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,n.SC)(this._analysisController),this._analysisVisualization=(0,n.SC)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get unit(){return(0,n.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:{...this._analysisVisualization?.testData,visualization:this._analysisVisualization,controller:this._analysisController}}};(0,s._)([(0,a.Cb)()],je.prototype,"updating",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"type",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0,nonNullable:!0})],je.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"result",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"measurementMode",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"viewMode",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,a.Cb)()],je.prototype,"visualElementOrientation",null),(0,s._)([(0,a.Cb)()],je.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,a.Cb)()],je.prototype,"triangleCollapseRatioThreshold",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"directLabelText",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"horizontalLabelText",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"verticalLabelText",null),(0,s._)([(0,a.Cb)()],je.prototype,"_analysisVisualization",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"_analysisController",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"unit",null),(0,s._)([(0,a.Cb)(l.Y)],je.prototype,"_defaultUnit",void 0),je=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],je);const Ue=je},76545:(e,t,i)=>{var s;i.d(t,{e:()=>s}),function(e){e[e.Auto=0]="Auto",e[e.Euclidean=1]="Euclidean",e[e.Geodesic=2]="Geodesic"}(s||(s={}))},56331:(e,t,i)=>{i.d(t,{D:()=>r});var s=i(17321);class r{constructor(e=null){this.spatialReference=e}get spatialReference(){return this._spatialReference}set spatialReference(e){e!==this._spatialReference&&(this._spatialReference=e,this._updateNormalizationFactors())}normalizeDistance(e){return e*this._metersPerDistanceUnit}normalizeElevation(e){return e*this._metersPerElevationUnit}normalizeArea(e){return e*this._squareMetersPerAreaUnit}_updateNormalizationFactors(){this._metersPerDistanceUnit=(0,s.c9)(this._spatialReference,1),this._metersPerElevationUnit=(0,s.c9)(this._spatialReference,1),this._squareMetersPerAreaUnit=this._metersPerDistanceUnit*this._metersPerDistanceUnit}}},28376:(e,t,i)=>{i.d(t,{G:()=>a,e:()=>o});var s=i(61681),r=i(90472),n=i(66143);function a(e,t,i,a=!1){const o=(0,r.fM)(e,t);return(0,s.Wi)(o)?null:(o.hasZ&&!a||!(0,s.pC)(i)||(o.z=(0,s.Pt)((0,n.KO)(i,o),0)),o)}function o(e,t,i){i.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${t.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},19570:(e,t,i)=>{i.d(t,{H:()=>a,c:()=>o});var s=i(95550),r=i(55709),n=i(6766);function a(e,t){if((0,n.s)(t,0,0,0),e.length>0){for(let i=0;i<e.length;++i)(0,n.a)(t,t,e[i]);(0,n.g)(t,t,1/e.length)}}function o(e,t,i,s){s.projectToRenderScreen(e,l),s.projectToRenderScreen(t,c),(0,r.a)(i,d,h),(0,r.f)(i,i)}const l=(0,s.J$)(),h=l,c=(0,s.J$)(),d=c},37926:(e,t,i)=>{i.d(t,{r:()=>_});var s=i(61681),r=i(24455),n=i(39100),a=i(6766),o=i(8909),l=i(18916),h=i(10449),c=i(24370),d=i(7358),u=i(65392);class _ extends h._{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=d.yD.OccludeAndTransparent,this._width=1,this._color=(0,l.f)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this._material=t,this._hasExternalMaterial=(0,s.pC)(t),this.applyProps(e)}setGeometryFromRenderSpacePoint(e,t=1e3){const i=[];i.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),i.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),i.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=i}setGeometryFromExtent(e){const t=this.view.spatialReference,i=(0,o.c)(),s=(0,o.c)(),r=100,n=[];(0,a.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,a.s)(i,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,a.s)(i,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,a.s)(i,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,a.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),(0,a.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,s),n.push([s[0],s[1],s[2]]),this.geometry=[n]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,s=e.basis1,r=e.basis2,n=.5,a=(0,o.c)(),l=(0,o.c)(),h=(0,o.c)(),c=(0,o.c)();a[0]=i[0]-s[0]*n-r[0]*n,a[1]=i[1]-s[1]*n-r[1]*n,a[2]=i[2]-s[2]*n-r[2]*n,l[0]=i[0]-s[0]*n+r[0]*n,l[1]=i[1]-s[1]*n+r[1]*n,l[2]=i[2]-s[2]*n+r[2]*n,h[0]=i[0]+s[0]*n+r[0]*n,h[1]=i[1]+s[1]*n+r[1]*n,h[2]=i[2]+s[2]*n+r[2]*n,c[0]=i[0]+s[0]*n-r[0]*n,c[1]=i[1]+s[1]*n-r[1]*n,c[2]=i[2]+s[2]*n-r[2]*n,t.push([a[0],a[1],a[2]]),t.push([l[0],l[1],l[2]]),t.push([h[0],h[1],h[2]]),t.push([c[0],c[1],c[2]]),t.push([a[0],a[1],a[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=(0,r.f)(p,t);const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e,t=o.Z){this.transform=(0,r.f)(p,t),this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}getTransformedGeometry(){return(0,s.Wi)(this._geometry)?null:this._geometry.map((e=>e.map((e=>(0,a.m)((0,o.c)(),e,this.transform)))))}get renderOccluded(){return(0,s.pC)(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,(0,s.pC)(this._material)&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return(0,s.pC)(this._material)?this._material.parameters.width:this._width}set width(e){this._width=e,(0,s.pC)(this._material)&&this._material.setParameters({width:e})}get color(){return(0,s.pC)(this._material)?this._material.parameters.color:this._color}set color(e){this._color=(0,l.a)(e),(0,s.pC)(this._material)&&this._material.setParameters({color:this._color})}get innerWidth(){return(0,s.pC)(this._material)?this._material.parameters.innerWidth:this._innerWidth}set innerWidth(e){this._innerWidth=e,(0,s.pC)(this._material)&&this._material.setParameters({innerWidth:e})}get innerColor(){return(0,s.pC)(this._material)?this._material.parameters.innerColor:this._innerColor}set innerColor(e){this._innerColor=(0,s.pC)(e)?(0,l.a)(e):e,(0,s.pC)(this._material)&&this._material.setParameters({innerColor:this._innerColor})}get stipplePattern(){return(0,s.pC)(this._material)?this._material.parameters.stipplePattern:this._stipplePattern}set stipplePattern(e){this._stipplePattern=e,(0,s.pC)(this._material)&&this._material.setParameters({stipplePattern:e})}get stippleOffColor(){return(0,s.pC)(this._material)?this._material.parameters.stippleOffColor:this._stippleOffColor}set stippleOffColor(e){this._stippleOffColor=(0,s.pC)(e)?(0,l.a)(e):null,(0,s.pC)(this._material)&&this._material.setParameters({stippleOffColor:this._stippleOffColor})}get stipplePreferContinuous(){return(0,s.pC)(this._material)?this._material.parameters.stipplePreferContinuous:this._stipplePreferContinuous}set stipplePreferContinuous(e){this._stipplePreferContinuous=e,(0,s.pC)(this._material)&&this._material.setParameters({stipplePreferContinuous:e})}get writeDepthEnabled(){return(0,s.pC)(this._material)?this._material.parameters.writeDepth:this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled=e,(0,s.pC)(this._material)&&this._material.setParameters({writeDepth:e})}get falloff(){return(0,s.pC)(this._material)?this._material.parameters.falloff:this._falloff}set falloff(e){this._falloff=e,(0,s.pC)(this._material)&&this._material.setParameters({falloff:e})}get polygonOffset(){return(0,s.pC)(this._material)?this._material.parameters.hasPolygonOffset:this._polygonOffset}set polygonOffset(e){this._polygonOffset=e,(0,s.pC)(this._material)&&this._material.setParameters({hasPolygonOffset:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new u.U({width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,c.c0)(this.geometry)){const i=(0,c.YU)(t);e.addGeometry(i,(0,s.Wg)(this._material))}}forEachExternalMaterial(e){this._hasExternalMaterial||e((0,s.Wg)(this._material))}}const p=(0,n.c)()},10449:(e,t,i)=>{i.d(t,{_:()=>c});var s=i(61681),r=i(24455),n=i(39100),a=i(76169),o=i(70984),l=i(49394),h=i(26982);class c extends a.l{constructor(e){super(e.view),this._resources=null,this._transform=(0,n.c)()}get object(){return(0,s.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,r.c)(this._transform,e),(0,s.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,s.Wi)(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new h.F({isPickable:!1,updatePolicy:o.jq.SYNC});e.add(t);const i=new l.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!(0,s.Wi)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((t=>{e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){(0,s.Wi)(this._resources)||this._resources.object.setVisible(e)}}},83061:(e,t,i)=>{i.d(t,{R:()=>b});var s=i(44584),r=i(61681),n=i(76868),a=i(24455),o=i(39100),l=i(6766),h=i(8909),c=i(88589),d=i(18916),u=i(68817),_=i(10449),p=i(47562),g=i(6087),m=i(7358),v=i(21414),y=i(84891),f=i(65392);class b extends _._{constructor(e){super(e),this._handles=new s.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,h.c)(),this._up=(0,h.c)(),this._right=(0,h.c)(),this._renderOccluded=m.yD.OccludeAndTransparent,this._color=(0,d.f)(1,0,0,1),this._outlineColor=(0,d.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=m.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,c.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,c.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,l.i)(t,e),(0,l.i)(t,i))/3,(0,l.n)(this._up,(0,l.b)(this._up,e,t)),(0,l.n)(this._right,(0,l.b)(this._right,i,t)),(0,l.c)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new y.E(this._quadMaterialParameters),this._outlineMaterial=new f.U(this._outlineMaterialParameters),this._handles.add((0,n.YP)((()=>this.view.state.camera),(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){(0,l.k)(this._up,h.Z)&&(0,l.k)(this._right,h.Z)||(this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e))}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,l.a)(u.WM.get(),this._up,this._right),i=(0,g.rh)([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,i);(0,a.f)(C,this._position),(0,a.k)(C,C,[s,s,s]),(0,r.pC)(e)&&(e.transformation=C)}_quadGeometryData(e,t){const i=(0,l.a)(u.WM.get(),e,t);return new p.Z([[v.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[v.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this._outlineMaterialParameters)}}const C=(0,o.c)()},76169:(e,t,i)=>{i.d(t,{l:()=>r});var s=i(76868);class r{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this._handle=(0,s.YP)((()=>this.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},46010:(e,t,i)=>{i.d(t,{EX:()=>r});var s=i(30936);function r(e){const{r:t,g:i,b:r}=function(e){let{r:t,g:i,b:r,a:n}=e;return n<1&&(t=Math.round(n*t+255*(1-n)),i=Math.round(n*i+255*(1-n)),r=Math.round(n*r+255*(1-n))),new s.Z({r:t,g:i,b:r})}(e);return.2126*t+.7152*i+.0722*r}}}]);