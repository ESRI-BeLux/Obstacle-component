"use strict";(self.webpackChunkobstacle_component=self.webpackChunkobstacle_component||[]).push([[3142],{97622:(e,t,i)=>{i.d(t,{Z:()=>f});var n=i(36663),s=(i(91957),i(8400)),r=i(41151),o=i(16068),a=i(82064),l=i(81977),c=(i(7753),i(69236)),d=i(40266),h=i(7283),u=i(67666);let p=class extends((0,a.eC)(r.j)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=s.n.Direct,this.offset=0,this.orientation=0}};(0,n._)([(0,l.Cb)({type:["length"],json:{write:{isRequired:!0}}})],p.prototype,"type",void 0),(0,n._)([(0,l.Cb)({type:u.Z,json:{write:!0}})],p.prototype,"startPoint",void 0),(0,n._)([(0,l.Cb)({type:u.Z,json:{write:!0}})],p.prototype,"endPoint",void 0),(0,n._)([(0,l.Cb)({type:s.V,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"measureType",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"offset",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.p)((e=>o.BV.normalize((0,h.q9)(e),0,!0)))],p.prototype,"orientation",void 0),p=(0,n._)([(0,d.j)("esri.analysis.LengthDimension")],p);const f=p},8400:(e,t,i)=>{var n;i.d(t,{V:()=>s,n:()=>n}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(n||(n={}));const s=[n.Horizontal,n.Vertical,n.Direct]},73142:(e,t,i)=>{i.r(t),i.d(t,{default:()=>us});var n,s,r=i(36663),o=i(53443),a=i(41831),l=i(13802),c=i(61681),d=i(76868),h=i(81977),u=(i(7753),i(7283),i(40266)),p=i(60573),f=i(8400),g=i(44584),m=i(17321),_=i(19431),y=i(39405),v=i(24455),S=i(39100),w=i(6766),C=i(8909),P=i(19546),x=i(68817),b=i(48358),M=i(45043),E=i(60033),D=i(90472),A=i(35925),T=i(89976);function O(e,t,i){const s=function(e,t,i,s){const r=(0,T.m)(i),o=(0,m.j5)(r);if((0,c.Wi)(o))return null;const a=t[2]-e[2];if(s===n.Vertical)return{verticalSigned:a,unit:o};if(!(0,D.SH)(e,i,z,r)||!(0,D.SH)(t,i,H,r))return null;if(s===n.Direct)return{direct:(0,w.i)(H,z),unit:o};if((0,w.s)(Z,e[0],e[1],t[2]),!(0,D.SH)(Z,i,Z,r))return null;const l=(0,w.i)(Z,H);return s===n.Horizontal?{horizontal:l,unit:o}:{direct:(0,w.i)(H,z),horizontal:l,vertical:Math.abs(a),unit:o}}(e,t,i,n.Direct);return(0,c.pC)(s)?(0,y.yG)(s.direct,s.unit):null}(s=n||(n={}))[s.Direct=0]="Direct",s[s.Horizontal=1]="Horizontal",s[s.Vertical=2]="Vertical";const R=(0,C.c)(),L=(0,C.c)(),z=(0,C.c)(),H=(0,C.c)(),Z=(0,C.c)();function k(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:s,orientation:r}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,offset:n,measureType:s,orientation:r}}function V({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,offset:i,measureType:n,orientation:s},r,o=null){if((0,c.Wi)(e)||(0,c.Wi)(t))return null;const a=N((0,c.pC)(o)?o.directSegment:new E.y,{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t},r),l=(0,c.pC)(o)?o.primaryOffsetAxis:(0,C.c)();X(l,{measureType:n,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,directSegment:a,orientation:s,renderCoordsHelper:r});const d=(0,c.pC)(o)?o.dimensionSegment:new E.y;return U({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t})&&n===f.n.Vertical?((0,w.c)(d.startRenderSpace,a.startRenderSpace),(0,w.c)(d.endRenderSpace,a.endRenderSpace)):B(d,{offsetAxis:l,offset:i,relativeToSegment:a,renderCoordsHelper:r}),{directSegment:a,dimensionSegment:d,primaryOffsetAxis:l,spatialReference:r.spatialReference}}function I(e,t,i,n){return t===G.Start?((0,w.c)(e.startRenderSpace,i.startRenderSpace),(0,w.c)(e.endRenderSpace,n.startRenderSpace)):((0,w.c)(e.startRenderSpace,i.endRenderSpace),(0,w.c)(e.endRenderSpace,n.endRenderSpace)),e}var G,W;function F(e,t,i,n){switch(t){case f.n.Direct:return N(e,i,n);case f.n.Horizontal:case f.n.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,dimension:o,geometry:a}=i;let l;o.measureType===f.n.Direct?(l=function(e,t){const i=e.directSegment.eval(.5,x.WM.get()),n=t.worldUpAtPosition(i,x.WM.get()),s=e.dimensionSegment.eval(.5,x.WM.get()),r=(0,w.y)(x.WM.get(),s,i);return!(0,w.F)(r,C.Z)&&(0,w.e)(r,n)>0}(a,n)===s.z>r.z,t===f.n.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:i}=e.dimensionSegment,{startRenderSpace:n,endRenderSpace:s}=e.directSegment;return(0,w.E)(n,t)<(0,w.E)(s,i)}(a);const[c,d]=l?[s,r]:[r,s],h=(0,M.WG)(d,j);return t===f.n.Horizontal?h.z=c.z:(h.x=c.x,h.y=c.y),n.toRenderCoords(c,e.startRenderSpace),n.toRenderCoords(h,e.endRenderSpace),e}}}function N(e,t,i){return i.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),i.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}(W=G||(G={}))[W.Start=0]="Start",W[W.End=1]="End";const j=(0,b.Tx)(0,0,0,null),Y=new E.y;function X(e,t){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:r,endRenderSpace:o},directSegment:a,renderCoordsHelper:l}=t,d=a.eval(.5,x.WM.get()),h=l.worldUpAtPosition(d,x.WM.get()),u=l.worldBasisAtPosition(d,P.R.Y,x.WM.get());switch(i){case f.n.Horizontal:(0,w.c)(e,h);break;case f.n.Vertical:(0,w.e)(r,h)<(0,w.e)(o,h)?(0,w.y)(e,o,r):(0,w.y)(e,r,o),(0,w.f)(e,e,h),(0,w.f)(e,e,h);break;case f.n.Direct:{const i=(0,c.Pt)(t.orientation,0);if(U({elevationAlignedStartPoint:n,elevationAlignedEndPoint:s}))(0,v.d)(q,-(0,_.Vl)(i),h),(0,w.m)(e,u,q);else{const t=(0,w.y)(x.WM.get(),o,r),n=(0,w.f)(x.WM.get(),t,h);(0,w.f)(n,n,t),(0,v.d)(q,(0,_.Vl)(i),t),(0,w.m)(e,n,q)}break}}return(0,w.F)(e,C.Z)?(0,w.c)(e,u):(0,w.n)(e,e)}const q=(0,S.c)();function U({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}){return(0,c.pC)(e)&&(0,c.pC)(t)&&e.x===t.x&&e.y===t.y}function B(e,t){const{offsetAxis:i,offset:n,relativeToSegment:{startRenderSpace:s,endRenderSpace:r},relativeToSegment:o,renderCoordsHelper:a}=t,l=n/a.unitInMeters,[c,d]=function(e,t,i,n=0){const s=(0,w.e)(t,i),r=(0,w.e)(e,i),o=Math.abs(s-r)+n;return s>r?[o,n]:[n,o]}(s,r,i,l);return(0,w.z)(e.startRenderSpace,o.startRenderSpace,i,c),(0,w.z)(e.endRenderSpace,o.endRenderSpace,i,d),e}function Q(e,t,i){const n=t.directSegment.eval(.5,x.WM.get());return i.worldUpAtPosition(n,e)}function J(e,t){const{startRenderSpace:i,endRenderSpace:n}=t.directSegment;return(0,w.y)(e,n,i)}function K(e,t,i={invert:!1}){const{startRenderSpace:n,endRenderSpace:s}=t.dimensionSegment;return i.invert?(0,w.y)(e,n,s):(0,w.y)(e,s,n)}function $(e,t){const i=e.directSegment.eval(.5,x.WM.get());return t.headingAtPosition(i,e.primaryOffsetAxis)}const ee=(0,C.c)();function te(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i}=e;if((0,c.Wi)(t)||(0,c.Wi)(i))return!1;const n=function(e,t){const{spatialReference:i}=e;return(0,A.fS)(i,t.spatialReference)?(R[0]=e.x,R[1]=e.y,R[2]=e.hasZ?e.z:0,L[0]=t.x,L[1]=t.y,L[2]=t.hasZ?t.z:0,O(R,L,i)):null}(t,i);return(0,c.pC)(n)&&(0,y.nn)(n,"meters").value>ie}const ie=1e5;function ne(e){return(0,c.pC)(e.geometry)}let se=class extends o.Z{constructor(e){super(e),this._handles=new g.Z}initialize(){const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles(e.on("change",(({added:e,removed:t})=>{for(const e of t)this._removeComputation(e);for(const t of e)this._addComputation(t)})))}destroy(){this._handles=(0,c.SC)(this._handles)}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,m.RG)(this.view)}_addComputation(e){this._handles.has(e)||this._handles.add((0,d.YP)((()=>k(e)),(t=>{const{measureType:i}=t;if(te(t)&&i!==f.n.Direct){const t=Math.round((0,m.En)(ie,"meters","kilometers"));return l.Z.getLogger(this.declaredClass).warnOnce(`A ${i} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${t} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const n=V(t,this.view.renderCoordsHelper,e.geometry);e.geometry=n,e.result.length=function(e,t,i){if((0,c.Wi)(e))return null;const n=O(e.dimensionSegment.startRenderSpace,e.dimensionSegment.endRenderSpace,e.spatialReference);if((0,c.Wi)(n))return null;const s=t===f.n.Vertical?(0,m.ov)(n.value,n.unit,i):(0,m.iS)(n.value,n.unit,i);return(0,y.nn)(n,s)}(n,i,this._defaultUnit)}),d.tX),e)}_removeComputation(e){this._handles.remove(e)}};(0,r._)([(0,h.Cb)({constructOnly:!0})],se.prototype,"analysisViewData",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],se.prototype,"view",void 0),(0,r._)([(0,h.Cb)()],se.prototype,"analysis",null),(0,r._)([(0,h.Cb)()],se.prototype,"_defaultUnit",null),se=(0,r._)([(0,u.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],se);var re=i(18234),oe=i(23148),ae=i(30936),le=(i(91957),i(16068)),ce=i(95550),de=i(69430);const he={main:new ae.Z([255,127,0])};class ue{constructor(){this.color=he.main,this.opacity=.5,this.radius=5}}class pe{constructor(){this.color=new ae.Z([127,127,127]),this.opacity=.5,this.radius=5}}class fe{constructor(){this.lineSizeFraction=.8}}class ge{constructor(){this.color=he.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1}}class me{constructor(){this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2}}class _e{constructor(){this.lineSizeFraction=.25}}class ye{constructor(){this.marginPx=20,this.minScreenLengthFontSizeFactor=5}}class ve{constructor(){this.color=new ae.Z([255,127,0,.5])}}const Se=new class{constructor(){this.pointManipulators=new ue,this.offsetManipulator=new ge,this.orientationManipulator=new me,this.markers=new fe,this.labels=new ye,this.offsetLine=new _e,this.constraint=new ve,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new pe,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}};var we=i(46707),Ce=i(74390),Pe=i(81536),xe=i(6411),be=i(6087),Me=i(34108),Ee=i(91258),De=i(67666);class Ae{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of f.V)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case f.n.Direct:return this.direct;case f.n.Horizontal:return this.horizontal;case f.n.Vertical:return this.vertical}}}function Te(e,{lineSizePt:t,material:i}){const{calloutOffsetPx:n,calloutOpacity:s,calloutWidth:r,discScale:o,focusMultiplier:a}=Se.orientationManipulator;return{calloutLength:.25*xe._Z*Se.markers.lineSizeFraction*(0,ce.F2)(t)+n,calloutOpacity:s,calloutWidth:r,customStateMask:Ye,discScale:o,focusMultiplier:a,material:i,metadata:e}}function Oe(e,t){return(0,Ce.Ju)(e,Te(t.metadata,t))}function Re(e,t){(0,Ce.Bz)(e,Te(e.metadata,t))}function Le(e){const{cancel:t,computation:i,settingHeading:n,steps:s,view:r}=e;if(!ne(i))return;const{renderCoordsHelper:o}=r,{dimension:a,geometry:l}=i,d=(0,C.c)(),h=Ge((0,C.c)(),l,l.directSegment,o),u=We(x.WM.get(),{forHeading:n,geometry:l,renderCoordsHelper:o}),p=(0,de.Yq)(h,u,(0,de.Ue)()),f=(0,c.Pt)(a.orientation,n?()=>$(l,r.renderCoordsHelper):0);s.next((0,Pe._N)(r,p)).next((e=>{"start"===e.action&&(0,w.c)(d,e.renderStart);const t=(0,de.mJ)(p),i=(0,Ce.Gd)(d,e.renderEnd,h,t);let s=f-(0,_.BV)(i);n||(s=function(e){const t=le.BV.normalize(e)%90;return t<Se.orientationSnapThresholdDegrees?e-t:90-t<Se.orientationSnapThresholdDegrees?e+(90-t):e}(s)),a.orientation=s})),t.next((0,Me.di)(a,["orientation"]))}function ze(e,t,i,n){const s=(0,w.b)(x.WM.get(),i.endRenderSpace,i.startRenderSpace);(0,w.f)(s,s,n);const r=(0,de.Yq)(i.startRenderSpace,s,(0,de.Ue)()),o=(0,de.Yq)(i.startRenderSpace,n,(0,de.Ue)()),a=t.offset;let l,c=0;const d=new Me.hM;return d.next((0,Pe._N)(e,r)).next((i=>{"start"===i.action&&(c=(0,de.jH)(o,i.renderStart));const n=((0,de.jH)(o,i.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=a+n,l=i})),e=>(d.execute(e),l)}function He(e,t){const{directSegment:i}=e,{renderCoordsHelper:n}=t,s=Q(x.WM.get(),e,n),r=J(x.WM.get(),e),o=(0,w.f)(x.WM.get(),r,s),{viewForward:a}=t.state.camera;(0,w.e)(o,a)>0&&(0,w.g)(o,o,-1);const l=i.eval(.5,x.WM.get());return n.headingAtPosition(l,o)}function Ze(e,t,i){const{dimensionSegment:n,primaryOffsetAxis:s}=t,r=K(Xe,t),o=(0,w.k)(r,C.Z)?(0,v.i)(Ue):(0,Ce.Aq)(r,s,C.Z,Ue),a=Math.max((0,w.l)(r),Se.offsetManipulator.minLengthMeters/i.unitInMeters);(0,v.k)(o,o,(0,w.s)(Xe,a,a,a)),e.modelTransform=o,e.renderLocation=n.eval(.5,Xe)}function ke(e,t,i,{forHeading:n}){const{dimension:s,geometry:r}=t,{primaryOffsetAxis:o}=r,a=(0,w.g)(Ve,o,s.offset>=0?1:-1),l=We(Ie,{forHeading:n,geometry:r,renderCoordsHelper:i});(0,w.f)(l,l,a);const c=(0,Ce.Aq)(a,l,C.Z,Ue);e.modelTransform=c,e.renderLocation=Ge(Xe,r,r.dimensionSegment,i)}const Ve=(0,C.c)(),Ie=(0,C.c)();function Ge(e,t,i,n){const{startRenderSpace:s,endRenderSpace:r}=i,o=function(e,t){const i=J(Fe,e),n=Q(Ne,e,t);return(0,w.e)(i,n)>0}(t,n)?s:r;return(0,w.c)(e,o)}function We(e,{forHeading:t,geometry:i,renderCoordsHelper:n}){return t?Q(e,i,n):K(e,i,{invert:!0})}const Fe=(0,C.c)(),Ne=(0,C.c)();function je(e){return(0,ce.F2)(e)+Se.offsetManipulator.focusedLinePaddingPx}const Ye=Ee.jg.Custom1,Xe=(0,C.c)(),qe=(0,C.c)(),Ue=(0,S.c)(),Be=new E.y;var Qe,Je=i(97622),Ke=i(53280),$e=i(67134),et=i(78668);function tt(e,t){if(te(e))return Qe.Direct;const{geometry:i}=e;if((0,c.Wi)(i)||(0,w.k)(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{constraintThresholdPx:n}=Se,{camera:s}=t.state,r=Q(x.WM.get(),i,t.renderCoordsHelper),o=J(x.WM.get(),i),a=(0,w.g)(x.WM.get(),r,(0,w.e)(o,r)),l=(0,w.b)(x.WM.get(),o,a),d=(0,w.p)(l),h=(0,w.p)(a),{startRenderSpace:u,endRenderSpace:p}=i.directSegment,f=Math.max(s.computeRenderPixelSizeAt(u)*n,s.computeRenderPixelSizeAt(p)*n)**2;return d<f?Qe.Vertical:h<f?Qe.Horizontal:null}i(39994),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(Qe||(Qe={}));var it=i(28401),nt=i(88589),st=i(18916),rt=i(70740),ot=i(59934),at=i(56215),lt=i(97537),ct=i(40199),dt=i(10449),ht=i(7358),ut=i(21414),pt=i(65392);class ft extends dt._{constructor(e){super(e),this._ray=(0,lt.Ue)(),this._externalResources=null,this._handles=new g.Z,this._isWorldDown=!1,this._start=(0,C.c)(),this._end=(0,C.f)(1,0,0),this._width=1,this._color=(0,st.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,st.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=vt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=ht.yD.OccludeAndTransparent,this._fadedExtensions=wt,this.applyProps(e)}createExternalResources(){const e=new pt.U(this.materialParameters);this._handles.add((0,d.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()})));const t=new ct.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){(0,c.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){(0,c.pC)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[(0,C.c)(),(0,C.c)()],i=this.extensionType===vt.FADED;i&&t.push((0,C.c)(),(0,C.c)());const n=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,s=(0,be.rh)(t,null,n);e.addGeometry(s,(0,c.Wg)(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),(0,c.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,w.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,w.b)(this._end,e,this._end),(0,lt.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,w.k)(this._start,e)||((0,w.c)(this._start,e),(0,lt.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,w.k)(this._end,e)||((0,w.c)(this._end,e),(0,lt.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,nt.g)(e,this._color)||((0,nt.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,nt.g)(e,this._innerColor)||((0,nt.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,c.pC)(e)!==(0,c.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,c.Wi)(e)||(0,c.Wi)(this._stippleOffColor)||!(0,nt.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,c.pC)(e)?(0,st.a)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,c.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,(0,c.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,c.pC)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,c.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=(0,c.Pt)(e,wt),this.recreateGeometry()}_updateMaterial(){(0,c.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){(0,c.pC)(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===vt.FADED?this._updateLineSegmentFinite(yt):this._updateLineSegmentInfinite(this._extensionType,yt);this._updateVertexAttributes(e,t),(0,c.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return(0,at.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,rt.iL)(this._ray,gt),e){case vt.LINE:gt.c0=-Number.MAX_VALUE;break;case vt.RAY:case vt.GROUND_RAY:{const e=this._ray.origin,t=(0,c.Pt)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,w.o)(gt.ray.direction,gt.ray.direction),this._extensionType===vt.GROUND_RAY&&null!=t&&(gt.c1=Math.abs(i-t));break}}if(!(0,ot.zq)(i.frustum,gt))return(0,at.zk)(this._start,this._end,t);const n=(0,rt.Ws)(gt,mt),s=(0,rt.S$)(gt,_t);return(0,at.zk)(n,s,t)}_updateVertexAttributes(e,t){const i=e.geometries[0].getMutableAttribute(ut.T.POSITION).data;if(this.extensionType===vt.FADED){const e=(0,at.KU)(t,-this.fadedExtensions.start,mt);i[0]=e[0],i[1]=e[1],i[2]=e[2];const n=(0,at.KU)(t,0,mt);i[3]=n[0],i[4]=n[1],i[5]=n[2];const s=(0,at.KU)(t,1,mt);i[6]=s[0],i[7]=s[1],i[8]=s[2];const r=(0,at.KU)(t,1+this.fadedExtensions.end,mt);i[9]=r[0],i[10]=r[1],i[11]=r[2]}else{const e=(0,at.KU)(t,0,mt);i[0]=e[0],i[1]=e[1],i[2]=e[2];const n=(0,at.KU)(t,1,mt);i[3]=n[0],i[4]=n[1],i[5]=n[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const gt=(0,rt.Ue)(),mt=(0,C.c)(),_t=(0,C.c)(),yt=(0,at.Ue)();var vt;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(vt||(vt={}));const St=1/3,wt={start:St,end:St};var Ct=i(55709);class Pt extends dt._{constructor(e){super(e),this._handles=new g.Z,this._location=(0,C.c)(),this._direction=(0,C.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,st.f)(1,0,1,1),this._renderOccluded=ht.yD.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){(0,w.k)(this._location,e)||((0,w.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,w.k)(this._direction,e)||((0,w.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,w.n)(this._direction,(0,w.b)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,nt.g)(e,this._color)||((0,nt.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new pt.U(this.materialParameters);this._handles.add((0,d.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=(0,be.rh)([(0,C.c)(),(0,C.c)()]),i=(0,be.rh)([(0,C.c)(),(0,C.c)()]),n=(0,c.Wg)(this._externalResources).material;e.addGeometry(t,n),e.addGeometry(i,n),this._updateVertices(e)}forEachExternalMaterial(e){(0,c.pC)(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){(0,c.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;(0,c.Wi)(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,bt),(0,w.a)(xt,this.location,this.direction),t.projectToScreen(xt,Mt),(0,Ct.f)(Mt,(0,Ct.a)(Mt,Mt,bt)),this._updateVertexAttributes(t,e,0,bt,Mt,1),this._updateVertexAttributes(t,e,1,bt,Mt,-1)}_updateVertexAttributes(e,t,i,n,s,r){const o=t.geometryRecords[i],a=o.geometry.getMutableAttribute(ut.T.POSITION).data,l=(0,Ct.b)(Et,(0,Ct.s)(Et,s[1]*r,s[0]*-r),this.offset+this.width/2),c=(0,Ct.j)(Dt,(0,Ct.j)(Dt,(0,Ct.j)(Dt,n,(0,Ct.b)(Dt,s,this.length/2)),l),l),d=(0,Ct.j)(At,c,(0,Ct.b)(At,s,-this.length));e.unprojectFromScreen(c,xt),a[0]=xt[0],a[1]=xt[1],a[2]=xt[2],e.unprojectFromScreen(d,xt),a[3]=xt[0],a[4]=xt[1],a[5]=xt[2],t.geometryVertexAttrsUpdated(o)}}const xt=(0,C.c)(),bt=(0,ce.s1)(),Mt=(0,ce.s1)(),Et=(0,ce.s1)(),Dt=(0,ce.s1)(),At=(0,ce.s1)();var Tt=i(48562),Ot=i(83061),Rt=i(50639),Lt=i(20999),zt=i(22519),Ht=i(9650);class Zt extends Ht.r{constructor(e,t,i=Lt.B.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof Zt&&(0,zt.Xv)(this.intersectionPoint,e.intersectionPoint)}}var kt=i(65453);class Vt extends Ht.r{constructor(e,t,i,n=Lt.B.ALL){super(i,n),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof Vt&&(0,zt.Xv)(this.lineStart,e.lineStart)&&(0,zt.Xv)(this.lineEnd,e.lineEnd)}}var It=i(82366);class Gt extends Ht.r{constructor(e,t,i,n,s=Lt.B.ALL){super(n,s),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof Gt&&(0,zt.Xv)(this.previousVertex,e.previousVertex)&&(0,zt.Xv)(this.centerVertex,e.centerVertex)&&(0,zt.Xv)(this.nextVertex,e.nextVertex)}}class Wt{draw(e,t){const i=this._getUniqueHints(e),n=[];for(const e of i)e instanceof Zt&&n.push(this.visualizeIntersectionPoint(e,t)),e instanceof kt.w&&n.push(this.visualizeLine(e,t)),e instanceof Vt&&n.push(this.visualizeParallelSign(e,t)),e instanceof Gt&&n.push(this.visualizeRightAngleQuad(e,t)),e instanceof It.n&&n.push(this.visualizePoint(e,t));return(0,oe.AL)(n)}_getUniqueHints(e){const t=[];for(const i of e){let e=!0;for(const n of t)if(i.equals(n)){e=!1;break}e&&t.push(i)}return t}}var Ft=i(86);class Nt extends Wt{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,view:n}=t;return(0,oe.ed)(new Tt.L({view:n,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:(0,c.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ae.Z.toUnitRGBA(Rt.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:i,coordinateHelper:n}=t,s=this._alignPoint(e.point,e.domain,t);return(0,oe.ed)(new Tt.L({view:i,primitive:"circle",geometry:n.vectorToPoint(s),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ae.Z.toUnitRGBA(Rt.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:i,coordinateHelper:n}=t,s=this._alignPoint(e.lineStart,e.domain,t),r=this._alignPoint(e.lineEnd,e.domain,t);return(0,oe.ed)(this._createLineSegmentHintFromMap(e.type,s,r,n,this._hintElevationInfo(e,t),i,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,coordinateHelper:n}=t,s=this._hintElevationInfo(e,t),r=this._alignPoint(e.lineStart,e.domain,t),o=this._alignPoint(e.lineEnd,e.domain,t),a=(0,Ft.$r)(r,n,s,i),l=(0,Ft.$r)(o,n,s,i),c=(0,w.h)(l,a,l,.5),d=new Pt({view:i,attached:!1,offset:Rt.c.parallelLineHintOffset,length:Rt.c.parallelLineHintLength,width:Rt.c.parallelLineHintWidth,color:ae.Z.toUnitRGBA(Rt.c.orange),location:c,renderOccluded:ht.yD.Opaque});return d.setDirectionFromPoints(a,c),d.attached=!0,(0,oe.ed)(d)}visualizeRightAngleQuad(e,t){const{view:i,coordinateHelper:n}=t,s=this._hintElevationInfo(e,t),r=this._alignPoint(e.previousVertex,e.domain,t),o=this._alignPoint(e.centerVertex,e.domain,t),a=this._alignPoint(e.nextVertex,e.domain,t);return(0,oe.ed)(new Ot.R({view:i,attached:!0,color:ae.Z.toUnitRGBA(Rt.c.orange),renderOccluded:ht.yD.Transparent,outlineRenderOccluded:ht.yD.Opaque,outlineColor:ae.Z.toUnitRGBA(Rt.c.orange),outlineSize:Rt.c.rightAngleHintOutlineSize,size:Rt.c.rightAngleHintSize,geometry:{previous:(0,Ft.$r)(r,n,s,i),center:(0,Ft.$r)(o,n,s,i),next:(0,Ft.$r)(a,n,s,i)}}))}_createLineSegmentHintFromMap(e,t,i,n,s,r,o=!0,a=!0){const l=(0,C.c)(),c=(0,C.c)();return(0,Ft.By)(t,i,n,s,r,l,c),this._createLineSegmentHint(e,r,l,c,o,a)}_createLineSegmentHint(e,t,i,n,s=!0,r=!0){const o=new ft({view:t,extensionType:vt.FADED,start:i,end:n,color:ae.Z.toUnitRGBA(Rt.c.orange),renderOccluded:ht.yD.Opaque});switch(e){case zt.ze.TARGET:o.width=Rt.c.lineHintWidthTarget,o.fadedExtensions={start:0,end:Rt.c.lineHintFadedExtensions};break;case zt.ze.REFERENCE_EXTENSION:o.width=Rt.c.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case zt.ze.REFERENCE:o.width=Rt.c.lineHintWidthReference,o.fadedExtensions={start:s?Rt.c.lineHintFadedExtensions:0,end:r?Rt.c.lineHintFadedExtensions:0}}return o.attached=!0,o}_alignPoint(e,t,i){const n=this._getSelfSnappingZ(t,i);if((0,c.Wi)(n))return e;const s=i.coordinateHelper,r=s.vectorToPoint(e,jt);return r.z=n,s.pointToVector(r)}_hintElevationInfo(e,t){return(0,c.pC)(this._getSelfSnappingZ(e.domain,t))?(0,c.Wg)(t.selfSnappingZ).elevationInfo:(0,c.Pt)(e.elevationInfo,t.elevationInfo)}_getSelfSnappingZ(e,{selfSnappingZ:t}){return e===Lt.B.SELF&&(0,c.pC)(t)?t.value:null}}const jt=new De.Z;var Yt=i(37926),Xt=i(39043),qt=i(1983),Ut=i(66962);const Bt={main:new ae.Z([255,127,0]),selected:new ae.Z([255,255,255]),staged:new ae.Z([12,207,255]),outline:new ae.Z([0,0,0,.5]),selectedOutline:new ae.Z([255,255,255])},Qt=.3;function Jt(e,t){const i=e.clone();return i.a*=t,i}function Kt(e,t){const i=e.clone(),n=(0,Xt._Y)(i);n.s*=t;const s=(0,Xt.xr)(n);return i.r=s.r,i.g=s.g,i.b=s.b,i}function $t(e,t){if(t)for(const i in t)e[i]=t[i]}class ei{constructor(e){this.color=Bt.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=ht.yD.Opaque,$t(this,e)}}class ti{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=Bt.main,this.outlineColor=Bt.outline,this.renderOccluded=ht.yD.Opaque,this.hoverOutlineColor=Bt.selectedOutline,$t(this,e)}apply(e,t){const i=this[e];t.setParameters({color:hi(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class ii{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Jt(Bt.main,.5),this.hoverColor=Bt.main,this.renderOccluded=ht.yD.Transparent,this.minSquaredEdgeLength=900,$t(this,e)}apply(e,t){const i=this[e];t.setParameters({color:hi(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class ni{constructor(e){this.vertex=new ti({color:Bt.main,outlineColor:Bt.outline}),this.edge=new ti({color:Kt(Jt(Bt.main,2/3),.5),outlineColor:Jt(Bt.outline,.5),size:8,collisionPadding:8}),this.selected=new ti({color:Bt.selected,outlineColor:Bt.outline}),this.edgeOffset=new ii,$t(this,e)}}class si{constructor(e){this.color=Bt.selected,this.width=1.5,this.stipplePattern=(0,Ut.z5)(5),this.stippleOffColor=Bt.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=Bt.selected,this.renderOccluded=ht.yD.OccludeAndTransparent,$t(this,e)}apply(e){e.color=hi(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=hi(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=hi(this.innerColor),e.renderOccluded=this.renderOccluded}}class ri{constructor(e){this.color=Bt.selected,this.size=4,this.outlineSize=1,this.outlineColor=Bt.outline,this.shape="square",$t(this,e)}apply(e){e.color=hi(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=hi(this.outlineColor),e.primitive=this.shape}}class oi{constructor(e){this.innerColor=Bt.selected,this.innerWidth=1,this.glowColor=Bt.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Qt,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=Bt.main,$t(this,e)}apply(e,t=1){const i={glowColor:ae.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:ae.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class ai{constructor(e){this.outline=new si({color:Bt.outline,renderOccluded:ht.yD.OccludeAndTransparentStencil,stippleOffColor:Bt.selected,stipplePattern:(0,Ut.z5)(5),width:1.5,innerWidth:0}),this.staged=new si({color:Bt.selected,renderOccluded:ht.yD.OccludeAndTransparentStencil,innerColor:Bt.staged,stippleOffColor:Bt.outline,stipplePattern:(0,Ut.z5)(5),width:1.5}),this.shadowStyle=new oi({globalAlpha:Qt,glowColor:Bt.main,glowFalloff:8,glowWidth:8,innerColor:Bt.selected,innerWidth:1}),$t(this,e)}}class li{constructor(e){this.outline=new ri({color:Bt.selected,outlineColor:Bt.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new oi({globalAlpha:Qt,glowColor:Bt.main,glowFalloff:1.5,glowWidth:6,innerColor:Bt.selected,innerWidth:1,radius:2}),$t(this,e)}}class ci extends si{constructor(e){super(),this.extensionType=vt.GROUND_RAY,$t(this,e)}}class di{constructor(e){this.lineGraphics=new ai,this.pointGraphics=new li,this.heightPlane=new oi({globalAlpha:Qt,glowColor:Bt.main,glowFalloff:8,glowWidth:8,innerColor:Bt.selected,innerWidth:1}),this.heightBox=new oi({globalAlpha:Qt,glowColor:Bt.main,glowFalloff:8,glowWidth:8,innerColor:Bt.selected,innerWidth:0,heightFillColor:Bt.main}),this.zVerticalLine=new ci({color:Jt(Bt.main,.5),falloff:2,innerColor:Jt(Bt.selected,0),renderOccluded:ht.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:vt.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,$t(this,e)}}function hi(e){return(0,qt.b)(ae.Z.toUnitRGBA(e))}const ui=new class{constructor(e){this.visualElements=new di,this.reshapeManipulators=new ni,this.zManipulator=new ei,$t(this,e)}colorToVec4(e){return hi(e)}};var pi=i(29642),fi=i(63669),gi=i(70984),mi=i(2070);class _i extends dt._{constructor(e){super(e),this.view=null,this._renderOccluded=ht.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=ui.colorToVec4(ui.reshapeManipulators.vertex.color),this._size=ui.reshapeManipulators.vertex.size,this._outlineColor=ui.colorToVec4(ui.reshapeManipulators.vertex.outlineColor),this._outlineSize=ui.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,nt.g)(e,this._color)||((0,nt.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,nt.g)(e,this._outlineColor)||((0,nt.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if((0,c.Wi)(e)||0===e.length)return[];const t=function(e,t,i,n,s){const r=new Float64Array(3*e.length),o=new Float64Array(r.length);e.forEach(((e,t)=>{r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e.length>2?e[2]:0}));const a=(0,fi.rR)(r,t,0,o,0,r,0,r.length/3,i,n,s),l=null!=a;return{numVertices:e.length,position:r,mapPosition:o,projectionSuccess:l,sampledElevation:a}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,pi.o.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,s=t.position;for(let e=0;e<n;++e){const t=(0,w.s)(yi,s[3*e+0],s[3*e+1],s[3*e+2]),n=vi(.5,t),r=vi(.5,t);i.push({vertexGeometry:n,vertexOutlineGeometry:r})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of t)e.addGeometry(i,this._vertexMaterial),e.addGeometry(n,this._vertexOutlineMaterial)}createExternalResources(){this._vertexMaterial=new mi.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:gi.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new mi.Q({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:gi.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const yi=(0,C.c)();function vi(e,t){return(0,be.PI)(e,16,16,{offset:t})}var Si=i(79591),wi=i(64594),Ci=i(4703),Pi=i(21739),xi=i(66581);let bi=class extends o.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,r._)([(0,h.Cb)({constructOnly:!0})],bi.prototype,"layer",void 0),(0,r._)([(0,h.Cb)()],bi.prototype,"enabled",void 0),(0,r._)([(0,h.Cb)()],bi.prototype,"updating",void 0),(0,r._)([(0,h.Cb)()],bi.prototype,"availability",void 0),bi=(0,r._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],bi);const Mi=bi;let Ei=class extends o.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new a.Z,this.distance=Rt.c.distance,this.touchSensitivityMultiplier=Rt.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,r._)([(0,h.Cb)()],Ei.prototype,"enabled",void 0),(0,r._)([(0,h.Cb)()],Ei.prototype,"enabledToggled",void 0),(0,r._)([(0,h.Cb)()],Ei.prototype,"selfEnabled",void 0),(0,r._)([(0,h.Cb)()],Ei.prototype,"featureEnabled",void 0),(0,r._)([(0,h.Cb)({type:a.Z.ofType(Mi)})],Ei.prototype,"featureSources",void 0),(0,r._)([(0,h.Cb)()],Ei.prototype,"distance",void 0),(0,r._)([(0,h.Cb)()],Ei.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],Ei.prototype,"effectiveEnabled",null),(0,r._)([(0,h.Cb)({readOnly:!0})],Ei.prototype,"effectiveSelfEnabled",null),(0,r._)([(0,h.Cb)({readOnly:!0})],Ei.prototype,"effectiveFeatureEnabled",null),Ei=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SnappingOptions")],Ei);const Di=Ei;var Ai,Ti=i(86114),Oi=i(17519),Ri=i(83772),Li=i(45666),zi=i(46455),Hi=i(7062),Zi=i(72461);class ki extends Zi.j{constructor({coordinateHelper:e,targetPoint:t,constraint:i,previousVertex:n,otherVertex:s,otherVertexType:r,objectId:o,elevationInfo:a}){super(e,t,i,a,Lt.B.SELF),this.previousVertex=n,this.otherVertex=s,this.otherVertexType=r,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===Ai.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===Ai.CENTER?this.targetPoint:this.otherVertex,n=this.elevationInfo;return[new kt.w(zt.ze.TARGET,t,i,n,this.domain),new kt.w(zt.ze.REFERENCE,e,t,n,this.domain),new Gt(this.previousVertex,t,i,n,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(Ai||(Ai={}));let Vi=class extends Ke.r{constructor(e){super(e),this.options=null,this._domain=Lt.B.FEATURE,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}get updating(){return(0,Ti.oE)(this.snappingSources,(({snappingSource:e})=>e.updating))||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,t=new Map;if((0,c.pC)(this.options)&&(0,c.pC)(this.options.featureSources))for(const i of this.options.featureSources.items){const n=i.layer.uid,s=e.get(n);if(s){e.delete(n),t.set(n,s);continue}if(!i.layer.loaded){this.updatingHandles.addPromise(i.layer.load());continue}const r=this._createSourceInfo(i);(0,c.pC)(r)&&t.set(n,r)}for(const[,t]of e)t.destroy();return t}initialize(){this.updatingHandles.add((()=>this.snappingSources),(()=>this.notifyChange("updating")),d.Z_),(0,c.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",(e=>this._updateLayerView(e.layer,e.layerView))),this.view.on("layerview-destroy",(e=>this._updateLayerView(e.layer,null)))])}_updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i,n){if(!(t&this._domain)||(0,c.Wi)(this.options)||!this.options.effectiveFeatureEnabled)return[];const s=[],r=this._computeScreeenSizeDistanceParameters(e,i),o={distance:r,point:e,coordinateHelper:i.coordinateHelper,types:this._types};for(const[,{snappingSource:e,layerView:t}]of this.snappingSources)!e.layerSource.enabled||(0,c.pC)(t)&&t.suspended||s.push(e.fetchCandidates(o,n).then((t=>t.filter((t=>!this._candidateIsExcluded(e,t,i.excludeFeature))))));const a=(await(0,et.WW)(s)).flat();return this._addRightAngleCandidates(a,e,r,i),(0,et.k_)(n),(0,zt.lQ)(e,a,i.coordinateHelper),a}_addRightAngleCandidates(e,t,i,n){const s=(0,c.pC)(n.vertexHandle)?n.vertexHandle.rightEdge?.rightVertex?.pos:(0,c.pC)(n.editGeometryOperations)&&"polygon"===n.editGeometryOperations.data.type?(0,c.Wg)(n.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,r=(0,c.pC)(n.vertexHandle)?n.vertexHandle.leftEdge?.leftVertex?.pos:(0,c.pC)(n.editGeometryOperations)?(0,c.Wg)(n.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,{view:o}=this,a=(0,zt.Z_)(s,o,n),l=(0,zt.Z_)(r,o,n),d=e.length;for(let s=0;s<d;s++)this._addRightAngleCandidate(e[s],l,t,i,n,e),this._addRightAngleCandidate(e[s],a,t,i,n,e)}_addRightAngleCandidate(e,t,i,n,s,r){const o=e instanceof zi.L,a=o&&(0,Ct.o)(e.constraint.start,e.constraint.end);if((0,c.Wi)(t)||!o||a)return;const l=e.constraint.closestTo(t),d=(l[0]-i[0])/n.x,h=(l[1]-i[1])/n.y;if(d*d+h*h<=1){const i=s.coordinateHelper,n=new ki({coordinateHelper:i,targetPoint:l,otherVertex:t,otherVertexType:Ai.NEXT,previousVertex:e.constraint.start,constraint:new Li.aU(i,t,l),objectId:e.objectId,elevationInfo:e.elevationInfo});r.push(n)}}_computeScreeenSizeDistanceParameters(e,t){let i=(0,c.pC)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return(0,c.Wi)(this.view)?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,n){const{coordinateHelper:s,elevationInfo:r}=n,{spatialReference:o}=s,a=s.hasZ()?Ri.jG:r,l=s.toXYZ(e,Wi);l[2]=(0,Ri.zx)(i,l,o,a,Ri.jG),i.renderCoordsHelper.toRenderCoords(l,o,Fi);const c=i.state.camera.computeScreenPixelSizeAt(Fi),d=c*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,h=t*d,u=(0,Ft.Rs)(l,o,Ri.jG,i),p=Gi(u,l,d,0,0,i,n),f=Gi(u,l,0,d,0,i,n),g=Gi(u,l,0,0,d,i,n);return{x:0===p?0:h/p,y:0===f?0:h/f,z:0===g?0:h/g,distance:c*t}}get _types(){return Oi.r.EDGE|Oi.r.VERTEX}_candidateIsExcluded(e,t,i){if((0,c.Wi)(i))return!1;const n=this._getCandidateObjectId(t);if((0,c.Wi)(n))return!1;const s=e.layerSource.layer;return"graphics"===s.type?i.uid===n:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===n}_getCandidateObjectId(e){return e instanceof Hi.a?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if((0,c.Wi)(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then((()=>{this.destroyed||this.notifyChange("snappingSources")}))),null;const i=(0,c.pC)(this.view)?this.view.allLayerViews.find((t=>t.layer===e.layer)):null;return new Ii(t.source,i)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}_createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;if((0,c.Wi)(t)||"3d"!==t.type)return null;const i=this._getSourceModule("scene");return(0,c.pC)(i.module)?{source:new i.module.SceneLayerSnappingSource({layerSource:e,view:t})}:{loading:i.loader}}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":case"oriented-imagery":{const t=this._getSourceModule("featureService");return(0,c.pC)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this._getSourceModule("featureCollection");return(0,c.pC)(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e,view:this.view})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return(0,c.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_createFeatureSnappingSourceMapNotesLayer(e){const t=this._getSourceModule("notes");return(0,c.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:()=>(0,c.pC)(e.layer.sublayers)?e.layer.sublayers.toArray():[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this._sourceModules[e];if((0,c.Wi)(t.loader)){const i=this._loadSourceModule(e).then((e=>{t.module=e}));return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){const t=this.updatingHandles;switch(e){case"featureService":return t.addPromise(i.e(3477).then(i.bind(i,33477)));case"featureCollection":return t.addPromise(i.e(4821).then(i.bind(i,84821)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(3840),i.e(7431)]).then(i.bind(i,17431)));case"scene":return t.addPromise(i.e(4064).then(i.bind(i,15519)))}return null}};(0,r._)([(0,h.Cb)({constructOnly:!0})],Vi.prototype,"spatialReference",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],Vi.prototype,"view",void 0),(0,r._)([(0,h.Cb)()],Vi.prototype,"options",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],Vi.prototype,"updating",null),(0,r._)([(0,h.Cb)({readOnly:!0})],Vi.prototype,"snappingSources",null),Vi=(0,r._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],Vi);class Ii{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new g.Z;const i=this.snappingSource.layerSource.layer;if("refresh"in i){const t=i;this.handles.add(t.on("refresh",(()=>e.refresh())))}this.handles.add([(0,d.YP)((()=>e.updating),(t=>e.layerSource.updating=t),d.tX),(0,d.YP)((()=>e.availability),(t=>e.layerSource.availability=t),d.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}function Gi(e,t,i,n,s,r,{coordinateHelper:o}){const a=(0,w.c)(Ni,t);a[0]+=i,a[1]+=n,a[2]+=s;const l=(0,Ft.Rs)(a,o.spatialReference,Ri.jG,r);return(0,zt.fG)(l,e)}const Wi=(0,C.c)(),Fi=(0,C.c)(),Ni=(0,C.c)();var ji=i(31355);class Yi{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=Rt.c.shortLineThreshold*Rt.c.shortLineThreshold}snap(e,t){return(0,c.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:i,editGeometryOperations:n}){const s=n.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,zt.Bb)((0,Ft.a7)(t,s,i,this.view),(0,Ft.a7)(e,s,i,this.view))>this.squaredShortLineThreshold}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class Xi extends Zi.j{constructor({coordinateHelper:e,lineStart:t,lineEnd:i,targetPoint:n,elevationInfo:s}){super(e,n,new Li.jg(e,t,i),s,Lt.B.SELF),this._referenceLineHint=new kt.w(zt.ze.REFERENCE_EXTENSION,t,i,s,this.domain)}get hints(){return[this._referenceLineHint,new kt.w(zt.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var qi=i(6271),Ui=i(23440);class Bi extends Yi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,s=[];if(n<1)return s;const r=t.coordinateHelper,o=(0,Ft.a7)(e,r,Ri.jG,this.view),{view:a}=this,l=i.edges[n-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const i=(0,zt._j)(c,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,s)}c=c.leftVertex.leftEdge}while(c&&c!==l);return s}snapExistingVertex(e,t){const i=[],n=(0,c.Wg)(t.vertexHandle),s=n.component;if(s.edges.length<2)return i;const{view:r}=this,{coordinateHelper:o}=t,a=(0,Ft.a7)(e,o,Ri.jG,r),l=n.leftEdge,d=n.rightEdge;l&&d&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal((0,zt.Z_)(l.leftVertex.pos,r,t),(0,zt.Z_)(d.rightVertex.pos,r,t),e,a,t,i);const h=s.edges[0];let u=h;do{if(u!==n.leftEdge&&u!==n.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const n=(0,zt._j)(u,r,t);this._processCandidateProposal(n.left,n.right,e,a,t,i)}u=u.rightVertex.rightEdge}while(u&&u!==h);return i}_processCandidateProposal(e,t,i,n,s,r){const{coordinateHelper:o,pointer:a}=s;o.toXYZ(e,Qi),o.toXYZ(t,Ji);const l=o.toXYZ(i,$i),c=(0,qi.ZE)(l,Ki),d=o.fromXYZ(c);(0,zt.Bb)(n,(0,Ft.a7)(d,o,Ri.jG,this.view))<this.squaredProximityThreshold(a)&&r.push(new Xi({coordinateHelper:o,lineStart:e,lineEnd:t,targetPoint:d,elevationInfo:o.hasZ()?Ri.jG:null}))}}const Qi=(0,C.c)(),Ji=(0,C.c)(),Ki={start:Qi,end:Ji,type:Ui.SP.LINE},$i=(0,C.c)();var en=i(69666);class tn extends Zi.j{constructor({coordinateHelper:e,referenceLine:t,lineStart:i,targetPoint:n,elevationInfo:s}){const r=e.toXYZ(i,nn),o=e.toXYZ(t.left,sn),a=e.toXYZ(t.right,rn);(0,w.b)(r,(0,w.a)(r,r,a),o),super(e,n,new Li.jg(e,i,e.fromXYZ(r)),s,Lt.B.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){const e=this.elevationInfo;return[new kt.w(zt.ze.TARGET,this.constraint.start,this.targetPoint,e,this.domain),new Vt(this.constraint.start,this.targetPoint,e,this.domain),...this._referenceLines.map((t=>new kt.w(zt.ze.REFERENCE,t.edge.left,t.edge.right,e,this.domain,t.fadeLeft,t.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0},{coordinateHelper:i}=this;this._referenceLines.forEach((n=>{i.equals(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),i.equals(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),i.equals(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),i.equals(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}const nn=(0,C.c)(),sn=(0,C.c)(),rn=(0,C.c)();class on extends Yi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,s=i.vertices.length,r=[];if(n<2)return r;const{view:o}=this,a=(0,Ft.a7)(e,t.coordinateHelper,Ri.jG,o),l=(0,zt.Z_)(i.vertices[s-1].pos,o,t),c=(0,zt.Z_)(i.vertices[0].pos,o,t),d=i.edges[n-1];let h=d;do{if(this.edgeExceedsShortLineThreshold(h,t)){const i=(0,zt._j)(h,o,t);this._checkEdgeForParalleLines(i,l,e,a,t,r),this._checkEdgeForParalleLines(i,c,e,a,t,r)}h=h.leftVertex.leftEdge}while(h&&h!==d);return r}snapExistingVertex(e,t){const i=[],n=(0,c.Wg)(t.vertexHandle),s=n.component;if(s.edges.length<3)return i;const{view:r}=this,o=(0,Ft.a7)(e,t.coordinateHelper,Ri.jG,r),a=n.leftEdge,l=n.rightEdge,d=s.vertices[0],h=(0,zt.Z_)(d.pos,r,t),u=s.vertices.length,p=s.vertices[u-1],f=(0,zt.Z_)(p.pos,r,t),g=s.edges[0];let m=g;do{if(m!==a&&m!==l&&this.edgeExceedsShortLineThreshold(m,t)){const s=(0,zt._j)(m,r,t);a&&this._checkEdgeForParalleLines(s,(0,zt.Z_)(a.leftVertex.pos,r,t),e,o,t,i),l&&this._checkEdgeForParalleLines(s,(0,zt.Z_)(l.rightVertex.pos,r,t),e,o,t,i),n===d?this._checkEdgeForParalleLines(s,f,e,o,t,i):n===p&&this._checkEdgeForParalleLines(s,h,e,o,t,i)}m=m.rightVertex.rightEdge}while(m&&m!==g);return i}_checkEdgeForParalleLines(e,t,i,n,s,r){const o=e.left,a=e.right;if((0,Ui.k0)(an,t,o,a),(0,Ct.k)(an,t)<Rt.c.parallelLineThreshold)return;(0,Ui.k0)(an,i,o,a,t);const{coordinateHelper:l,pointer:c}=s,d=l.fromXYZ(an,l.getZ(i,0));if((0,zt.Bb)(n,(0,Ft.a7)(d,l,Ri.jG,this.view))<this.squaredProximityThreshold(c)){if(this._parallelToPreviousCandidate(e,r))return;r.push(new tn({coordinateHelper:l,referenceLine:e,lineStart:t,targetPoint:d,elevationInfo:l.hasZ()?Ri.jG:null}))}}_parallelToPreviousCandidate(e,t){const i=e.left,n=e.right;for(const s of t)if((0,Ui.k0)(an,n,s.constraint.start,s.constraint.end,i),(0,Ct.k)(an,n)<Rt.c.parallelLineThreshold)return s.addReferenceLine(e),!0;return!1}}const an=(0,en.a)();class ln extends Yi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.vertices.length,s=[];if(n<2)return s;const{view:r}=this,o=(0,Ft.a7)(e,t.coordinateHelper,Ri.jG,r),a=i.vertices[n-1];if(this.edgeExceedsShortLineThreshold(a.leftEdge,t)){const i=(0,zt.Z_)(a.pos,r,t),n=(0,zt._j)(a.leftEdge,r,t);this._checkForSnappingCandidate(s,n,i,e,n.left,i,t,e,o)}const l=i.vertices[0];if(this.edgeExceedsShortLineThreshold(l.rightEdge,t)){const i=(0,zt.Z_)(l.pos,r,t),n=(0,zt._j)(l.rightEdge,r,t);this._checkForSnappingCandidate(s,n,i,e,n.right,i,t,e,o)}return s}snapExistingVertex(e,t){const i=[],n=(0,c.Wg)(t.vertexHandle),s=n.component,r=s.vertices.length;if(r<3)return i;const{view:o}=this,a=(0,Ft.a7)(e,t.coordinateHelper,Ri.jG,o),l=n.leftEdge,d=n.rightEdge,h=s.vertices[0],u=s.vertices[r-1];if(!l){const n=h.rightEdge.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const s=(0,zt._j)(n,o,t),r=(0,zt.Z_)(h.rightEdge.rightVertex.pos,o,t);this._checkForSnappingCandidate(i,s,r,e,s.right,r,t,e,a)}return i}if(!d){const n=u.leftEdge.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const s=(0,zt._j)(n,o,t),r=(0,zt.Z_)(u.leftEdge.leftVertex.pos,o,t);this._checkForSnappingCandidate(i,s,r,e,s.left,r,t,e,a)}return i}if(l&&l.leftVertex.leftEdge){const n=l.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const s=(0,zt._j)(n,o,t),r=(0,zt.Z_)(l.leftVertex.pos,o,t);this._checkForSnappingCandidate(i,s,r,e,s.left,r,t,e,a)}}if(d&&d.rightVertex.rightEdge){const n=d.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const s=(0,zt._j)(n,o,t),r=(0,zt.Z_)(d.rightVertex.pos,o,t);this._checkForSnappingCandidate(i,s,r,e,s.right,r,t,e,a)}}return i}_checkForSnappingCandidate(e,t,i,n,s,r,o,a,l){const{coordinateHelper:c,pointer:d}=o;(0,Ct.a)(cn,t.right,t.left);const h=(0,w.s)(un,cn[1],-cn[0],0),u=(0,Ct.h)(h,(0,Ct.a)(cn,n,i))/(0,Ct.v)(h),p=c.fromXYZ((0,Ct.w)(cn,r,h,u),c.getZ(a,0));if((0,zt.Bb)(l,(0,Ft.a7)(p,c,Ri.jG,this.view))<this.squaredProximityThreshold(d)){const t=c.toXYZ(r,dn),i=(0,w.z)(hn,t,h,Math.sign(u)),n=c.fromXYZ(i);e.push(new ki({coordinateHelper:c,targetPoint:p,constraint:new Li.aU(c,r,n),previousVertex:s,otherVertex:r,otherVertexType:Ai.CENTER,elevationInfo:c.hasZ()?Ri.jG:null}))}}}const cn=(0,en.a)(),dn=(0,C.c)(),hn=(0,C.c)(),un=(0,C.c)();class pn extends Zi.j{constructor({coordinateHelper:e,targetPoint:t,point1:i,point2:n,elevationInfo:s}){super(e,t,new Li.UL(e,e.arrayToVector((0,Ct.l)(fn,i,n,.5)),.5*(0,Ct.d)(i,n)),s,Lt.B.SELF),this._p1=i,this._p2=n}get hints(){const e=this.elevationInfo;return[new kt.w(zt.ze.REFERENCE,this.targetPoint,this._p1,e,this.domain),new kt.w(zt.ze.REFERENCE,this.targetPoint,this._p2,e,this.domain),new Gt(this._p1,this.targetPoint,this._p2,e,this.domain)]}}const fn=(0,en.a)();class gn extends Yi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=[],s=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||s<2)return n;const{view:r}=this,o=i.vertices[0],a=i.vertices[s-1],l=(0,zt.Z_)(o.pos,r,t),c=(0,zt.Z_)(a.pos,r,t);return this._processCandidateProposal(l,c,e,t,n),n}snapExistingVertex(e,t){const i=[],n=(0,c.Wg)(t.vertexHandle),s=n.component;if(s.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===n.index||n.index===s.vertices.length-1))return i;const{view:r}=this,o=(0,zt.Z_)(n.leftEdge.leftVertex.pos,r,t),a=(0,zt.Z_)(n.rightEdge.rightVertex.pos,r,t);return this._processCandidateProposal(o,a,e,t,i),i}_processCandidateProposal(e,t,i,n,s){if(!this.exceedsShortLineThreshold(e,t,n))return;const r=(0,Ct.l)(mn,e,t,.5),o=.5*(0,Ct.d)(e,t),a=(0,Ui.xO)(_n,i,r,o),{coordinateHelper:l,pointer:c}=n,d=l.fromXYZ(a,l.getZ(i,0)),h=(0,Ft.a7)(i,l,Ri.jG,this.view);(0,zt.Bb)(h,(0,Ft.a7)(d,l,Ri.jG,this.view))<this.squaredProximityThreshold(c)&&s.push(new pn({coordinateHelper:l,targetPoint:d,point1:e,point2:t,elevationInfo:l.hasZ()?Ri.jG:null}))}}const mn=(0,en.a)(),_n=(0,en.a)();let yn=class extends o.Z{constructor(e){super(e),this.updating=!1,this._snappers=new a.Z,this._domain=Lt.B.SELF}initialize(){this._snappers.push(new on(this.view,this.options),new Bi(this.view,this.options),new ln(this.view,this.options),new gn(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const n=[];for(const t of this._snappers.items)for(const s of t.snap(e,i))n.push(s);return(0,zt.lQ)(e,n,i.coordinateHelper),n}};function vn(e,t){return[new yn({view:e,options:t}),new Vi({view:e,options:t,spatialReference:e.spatialReference})]}(0,r._)([(0,h.Cb)({readOnly:!0})],yn.prototype,"updating",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],yn.prototype,"view",void 0),(0,r._)([(0,h.Cb)()],yn.prototype,"options",null),yn=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SelfSnappingEngine")],yn);class Sn extends Zi.j{constructor(e,t,i,n,s){super(e,t,new Li.Bq(e,t,i.constraint,n.constraint),s,Lt.B.ALL),this.first=i,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Zt(this.targetPoint,this.elevationInfo,this.domain)]}}let wn=class extends(ji.Z.EventedMixin(Ke.r)){constructor(e){super(e),this.options=new Di,this.snappingEnginesFactory=vn,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Cn.MAIN}initialize(){this.handles.add([(0,d.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}}),(()=>{this.doneSnapping(),this.emit("changed")}),d.Z_),(0,d.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),d.Z_),(0,d.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(({viewReady:e,snappingEnginesFactory:t})=>this._recreateEngines(e,t)),d.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:n}=this;this._engines=t(i,n)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e){return function(e){return(0,c.pC)(e.scenePoint)}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const n=this._currentMainCandidate;if((0,c.Wi)(n))return t;const s=this._selectUpdateInput(e);if((0,c.Wi)(s))return t;const{coordinateHelper:{spatialReference:r}}=i,o=(0,D.iV)(this._convertPointElevation(s,i),r);if((0,c.Wi)(o))return t;const{view:a}=this,{coordinateHelper:l,elevationInfo:d,visualizer:h}=i,u=[],p=l.pointToVector(o),f=n.constraint.closestTo(p);if(!this._arePointsWithinScreenThreshold(p,f,i))return this._resetSnappingState(),t;n.targetPoint=f,u.push(...n.hints);for(const e of this._currentOtherActiveCandidates)e.targetPoint=f,u.push(...e.hints);(0,c.pC)(h)&&this.handles.add(h.draw(u,{coordinateHelper:l,elevationInfo:xn(i),view:a,selfSnappingZ:i.selfSnappingZ}),Pn);const g=l.vectorToDehydratedPoint(f);return this._convertPointElevation(g,i,Ri.jG,d)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case Cn.MAIN:return e;case Cn.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Cn.MAIN}_removeVisualization(){this.handles.remove(Pn)}async _snapSinglePoint({point:e,context:t,signal:i}){const{coordinateHelper:n}=t,{view:s}=this,r=this._convertPointElevation(e,t),o=n.pointToVector(r),a=await this._fetchCandidates(o,Lt.B.ALL,t,i);return this._createSnapResult(o,Cn.MAIN,a,s,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:n}){const{view:s}=this,{coordinateHelper:r}=i,{spatialReference:o}=r;await(0,D.iQ)(t.spatialReference,o);const a=(0,D.iV)(this._convertPointElevation(t,i),o),l=r.pointToVector(a),c=await this._fetchCandidates(l,Lt.B.FEATURE,i,n);if(c.length>0){const e=await this._fetchCandidates(l,Lt.B.SELF,i,n);return this._createSnapResult(l,Cn.SCENE,[...c,...e],s,i,n)}const d=this._convertPointElevation(e,i),h=r.pointToVector(d),u=await this._fetchCandidates(h,Lt.B.SELF,i,n);return this._createSnapResult(h,Cn.MAIN,u,s,i,n)}async _fetchCandidates(e,t,i,n){return(await Promise.all(this._engines.map((s=>s.fetchCandidates(e,t,i,n))))).flat()}_createSnapResult(e,t,i,n,s,r){return{get valid(){return!(0,et.Hc)(r)},apply:()=>{const{elevationInfo:r,coordinateHelper:o}=s,{snappedPoint:a,hints:l}=this._processCandidates(e,t,i,s);return this._removeVisualization(),(0,c.pC)(s.visualizer)&&this.handles.add(s.visualizer.draw(l,{coordinateHelper:o,elevationInfo:xn(s),view:n,selfSnappingZ:s.selfSnappingZ}),Pn),this._convertPointElevation(a,s,Ri.jG,r)}}}_processCandidates(e,t,i,n){const{coordinateHelper:s}=n;if(i.length<1)return this.doneSnapping(),{snappedPoint:s.vectorToDehydratedPoint(e),hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,zt.lQ)(e,i,s);const r=this._currentMainCandidate;if((0,c.pC)(r)){const s=this._findOldConstraintInNewCandidates(r,i);if(s>=0){if(!(i[s]instanceof Sn))return this._intersectWithOtherCandidates(s,i,e,t,n);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,n))return this._updateSnappingCandidate(r,t,i,n)}}return this._intersectWithOtherCandidates(0,i,e,t,n)}_findOldConstraintInNewCandidates(e,t){return e instanceof Sn?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,n,s){const{coordinateHelper:r}=s,o=t[e],a=[];for(let n=0;n<t.length;++n){if(n===e)continue;const s=t[n];for(const e of o.constraint.intersect(s.constraint)){const t=r.fromXYZ(e.closestTo(o.targetPoint),o.targetPoint[2]);a.push([new Sn(r,t,o,s,s.elevationInfo),this._squaredScreenDistance(i,t,r)])}}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(a[0][0],n,t,s):this._updateSnappingCandidate(o,n,t,s)}_updateSnappingCandidate(e,t,i,n){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const s=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const t of i){if(e instanceof Sn){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;t.constraint.check(s)&&(t.targetPoint=s,this._currentOtherActiveCandidates.push(t),r.push(...t.hints))}return{snappedPoint:n.coordinateHelper.vectorToDehydratedPoint(s),hints:r}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,zt.Bb)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,Ft.a7)(e,t,Ri.jG,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let n=0;n<e.length;++n)if(t.constraint.equals(e[n].constraint)){i=n;break}return i}_convertPointElevation(e,t,i=t.elevationInfo,n=Ri.jG){const{view:s}=this;if(!((0,c.pC)(e)&&t.coordinateHelper.hasZ()&&(0,c.pC)(s)&&"3d"===s.type))return e;const r=(0,$e.d9)(e);return r.z=(0,Ri.vQ)(s,r,i,n),r}get test(){return{visualizationsActive:this.handles.has(Pn),engines:this._engines}}};var Cn;(0,r._)([(0,h.Cb)({constructOnly:!0})],wn.prototype,"view",void 0),(0,r._)([(0,h.Cb)()],wn.prototype,"options",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],wn.prototype,"updating",null),(0,r._)([(0,h.Cb)()],wn.prototype,"snappingEnginesFactory",void 0),(0,r._)([(0,h.Cb)()],wn.prototype,"_engines",void 0),(0,r._)([(0,h.Cb)()],wn.prototype,"_squaredMouseProximityTreshold",null),(0,r._)([(0,h.Cb)()],wn.prototype,"_squaredTouchProximityThreshold",null),wn=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SnappingManager")],wn),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Cn||(Cn={}));const Pn="visualization-handle";function xn({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Ri.jG:t}const bn=new Map;class Mn{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}}var En=i(41109),Dn=i(22167);class An{constructor(){this.next=new Me.hM}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:n,updatingHandles:s,useZ:r=!0}){if((0,c.Wi)(i))return e=>e;let o=null,a=null;const l=()=>{o=(0,c.IM)(o),i.doneSnapping(),(0,c.pC)(a)&&a.frameTask.remove(),a=null};t.next((e=>(l(),e))),this.next=new Me.hM;const d=this._createSnapFunction(i,r);let h=null,u=null,p=null;return t=>{if(!e(t))return t;if("start"===t.action){const e=this._createFrameTask(i.view);if(a=this._createSnappingInfo(n,t,e),a.context.selfSnappingZ=null,!r&&(0,c.pC)(t.info)){const e=this._extractSelfSnappingZ(n.coordinateHelper,t.info.handle.component);(0,c.pC)(e)&&(a.context.selfSnappingZ={value:e,elevationInfo:n.elevationInfo})}}if((0,c.pC)(a)){const{context:e,originalScenePos:n,originalPos:l}=a,{mapEnd:f,mapStart:g,action:m,scenePoints:_}=t,y=this._updatePosition(l,this._computeMapDelta(f,g)),v=this._computeMapDelta(g,l),S={...t,action:"update"},w=a.context,C=this._updateScenePosition(n,_),P=i.update({point:y,scenePoint:C,context:e});if(p=P,this._applySnappedUpdate(f,P,v,r),h=y,u=C,"end"!==m){const{frameTask:e}=a;(0,c.Wi)(o)&&(o=new AbortController),s.addPromise((0,et.R8)(d({frameTask:e,event:S,context:w,point:y,scenePoint:C,delta:v,lastPos:h,lastScenePos:u,lastUpdate:p},o.signal)))}}return"end"===t.action&&l(),t}}_createSnapFunction(e,t){return(0,et.Ds)((async({frameTask:i,point:n,scenePoint:s,context:r,event:o,delta:a,lastPos:l,lastScenePos:d,lastUpdate:h},u)=>{const p=await i.schedule((()=>e.snap({point:n,scenePoint:s,context:r,signal:u})),u);if(p.valid){let s=await i.schedule((()=>p.apply()),u);n!==l&&(0,c.pC)(l)&&(s=e.update({point:l,scenePoint:d,context:r})),(0,En.k)(s,h)||(this._applySnappedUpdate(o.mapEnd,s,a,t),this.next.execute(o))}}))}_createFrameTask(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(Dn.T8.SNAPPING):Dn.sq}_createSnappingInfo(e,t,i){return{context:new Mn({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:(0,c.pC)(t.info)?t.info.handle:null,excludeFeature:e.excludeFeature,visualizer:e.visualizer}),originalPos:(0,c.pC)(t.snapOrigin)?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:(0,c.pC)(t.scenePoints)?t.scenePoints.sceneStart:null,frameTask:i}}_updatePosition(e,[t,i,n]){const s=(0,M.WG)(e);return s.x+=t,s.y+=i,s.hasZ&&(s.z+=n),s}_updateScenePosition(e,t){return(0,c.Wi)(e)||(0,c.Wi)(t)?null:this._updatePosition(e,this._computeMapDelta(t.sceneEnd,t.sceneStart))}_computeMapDelta(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}_applySnappedUpdate(e,t,[i,n,s],r){e.x=t.x+i,e.y=t.y+n,r&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}_extractSelfSnappingZ(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const t of i){const i=e.getZ(t.pos);if((0,c.pC)(n)&&Math.abs(i-n)>1e-6)return null;(0,c.Wi)(n)&&(n=i)}return n}}let Tn=class extends o.Z{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,et.Ds)((async(e,t,i,n)=>{const s=await this._frameTask.schedule((()=>t.snap({...e,context:i,signal:n})),n);s.valid&&await this._frameTask.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&(0,c.pC)(this._snapPoints)&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=(0,c.pC)(e)?e.registerTask(Dn.T8.SNAPPING):Dn.sq}destroy(){this._abortController=(0,c.IM)(this._abortController),this._frameTask=(0,c.hw)(this._frameTask)}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,(0,c.Wi)(this._abortController)&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}abort(){this._abortController=(0,c.IM)(this._abortController)}};(0,r._)([(0,h.Cb)({constructOnly:!0})],Tn.prototype,"view",void 0),(0,r._)([(0,h.Cb)()],Tn.prototype,"stagedPoint",null),(0,r._)([(0,h.Cb)()],Tn.prototype,"constrainResult",void 0),(0,r._)([(0,h.Cb)()],Tn.prototype,"_stagedPoint",void 0),Tn=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SnappingOperation")],Tn);let On=class extends Ke.r{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new g.Z,this._snappingPipeline=new An,this._snappingManagerResult=function(e){if(!bn.has(e)){const t=function(e,t){const i=new Di({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:t?.distance??Rt.c.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??Rt.c.touchSensitivityMultiplier});return{...(0,d.YP)((()=>e.map?.allLayers?.toArray()??[]),(e=>{i.featureSources=new a.Z(e.map((e=>new Mi({layer:e,enabled:!0}))))}),d.nn),options:i}}(e,{distance:10}),i=function(e,t){return new wn({view:e,options:t,snappingEnginesFactory:(t,i)=>[new Vi({view:e,spatialReference:e.spatialReference,options:i})]})}(e,t.options);bn.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=bn.get(e);t.referenceCount++;const i=(0,oe.kB)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,xi.Y)((()=>{0===t.referenceCount&&(t.remove(),bn.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...i}}(e.view),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=Rn(),this._focusedOffsetManipulatorMaterial=Rn(),this._thinOffsetManipulatorMaterial=Rn(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,Ut.z5)(2)}),this._constraintSnappingIndicator=new Yt.r({view:e.view,attached:!0,width:1,color:ae.Z.toUnitRGBA(Se.constraint.color),renderOccluded:ht.yD.OccludeAndTransparent,stipplePattern:(0,Ut.z5)(5)});const t=ae.Z.toUnitRGBA(Se.disabledPointIndicator.color);t[3]*=Se.disabledPointIndicator.opacity,this._stagedStartIndicator=new _i({view:e.view,attached:!1,color:t,size:2*Se.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:ht.yD.OccludeAndTransparent})}initialize(){this._snappingOperation=new Tn({view:this.view}),this._orientationManipulatorTexture=(0,it.O)(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new Si.j({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:ht.yD.Opaque});const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles([e.on("after-add",(e=>this._addComputation(e.item))),e.on("after-remove",(e=>this._removeComputation(e.item)))]),this.addHandles([(0,d.YP)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(({stagedPoint:e,stagedComputation:t})=>{if((0,c.Wi)(t)||(0,c.Wi)(e))return;const i=(0,M.WG)(e,new De.Z);this._applyPointUpdate(t,{endPoint:i})}),d.Z_),(0,d.YP)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:s}=e;if(i===t.stagedDimension&&s===t.firstGrabbedManipulator){for(const i of[n,t.selectedComputation])if((0,c.pC)(i)){const t=this._computationManipulators.get(i);this._updateManipulators(i,t,e)}}else for(const[t,i]of this._computationManipulators)this._updateManipulators(t,i,e)}),d.tX),(0,d.YP)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),d.nn),(0,d.YP)((()=>this.view.state.camera),(()=>{(0,c.pC)(this._stagedComputation)&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,d.YP)((()=>(0,c.yw)(this._stagedComputation,(e=>{const t=e.elevationAlignedStartPoint,i=(0,C.c)();return(0,c.pC)(t)&&this.view.renderCoordsHelper.toRenderCoords(t,i)?i:null}))),(e=>{(0,c.pC)(e)?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles)}destroy(){this._snappingOperation=(0,c.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if((0,c.pC)(this._stagedComputation))return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&(0,c.pC)(e)?e:null}get _stagedComputation(){const e=this._stagedDimension,t=this.analysisViewData.computations.at(-1);return(0,c.Wi)(e)||(0,c.Wi)(t)||t.dimension!==e?null:t}get _constraintHandles(){return[(0,d.gx)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=tt(e,this.view)}),{...d.tX,equals:$e.fS}),(0,d.YP)((()=>{const e=this._activeComputation;if((0,c.Wi)(e))return null;const{measureType:t,orientation:i}=e.dimension;return{measureType:t,orientation:i,computation:e}}),((e,t)=>{if((0,c.pC)(e)&&(0,c.Wi)(t)){const{measureType:t,orientation:i,computation:n}=e;switch(n.previousConstraint){case Qe.Horizontal:n.preConstraintProperties={measureType:f.n.Horizontal,orientation:0};break;case Qe.Vertical:n.preConstraintProperties={measureType:f.n.Vertical,orientation:0};break;case Qe.Direct:n.preConstraintProperties={measureType:f.n.Direct,orientation:i};break;default:n.preConstraintProperties={measureType:t,orientation:i}}}(0,c.Wi)(e)&&(0,c.pC)(t)&&(t.computation.preConstraintProperties=null)}),d.Z_)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,d.YP)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(({stagedComputation:t,activeComputation:i})=>{const n=this._constraintSnappingIndicator;if(this.removeHandles(e),(0,c.Wi)(i))n.attached=!1;else if(i===t)n.attached=!0;else{const{start:t,end:s}=this._computationManipulators.get(i),r=()=>{n.attached=t.grabbing||s.grabbing};r(),this.addHandles([t.events.on("grab-changed",r),s.events.on("grab-changed",r)],e)}})),(0,d.YP)((()=>{const e=this._activeComputation;return(0,c.pC)(e)?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(({geometry:e,constraint:t})=>{const i=this._constraintSnappingIndicator;(0,c.pC)(e)&&(0,c.pC)(t)&&t!==Qe.Direct?(i.visible=!0,i.setGeometryFromSegment(e.directSegment)):i.visible=!1}))]}removeStaged(){return!!(0,c.pC)(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if((0,c.Wi)(t)){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove({mapPoint:e,pointerType:t}){if("touch"===t)return;const i=this._snappingContext(t);this.updatingHandles.addPromise((0,et.R8)(this._snappingOperation.snap({point:e},this._snappingManager,i)))}onManipulatorSelectionChanged(){(0,c.pC)(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:e,pointerType:t}){let i=e;if("mouse"===t){const n=this._snappingContext(t);i=this._snappingManager.update({point:e,context:n})}const n=new Je.Z({startPoint:(0,M.WG)(i,new De.Z),endPoint:null,measureType:f.n.Horizontal});return this._stagedDimension=n,this._resetSnappingState(),n}_onStagedClick({mapPoint:e,pointerType:t}){const i=this._stagedComputation;if((0,c.Wi)(i))return;let n=e;if("mouse"===t){const i=this._snappingContext(t);n=this._snappingManager.update({point:e,context:i})}const s=(0,M.WG)(n,new De.Z);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_addComputation(e){if(this._computationManipulators.has(e))return;const t=this._setupPointManipulator(e,{isStart:!0}),i=this._setupPointManipulator(e,{isStart:!1}),n=this._setupOffsetManipulator(e),s=this._setupHeadingManipulator(e),r=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,f.n.Direct),a=this._setupMeasureTypeManipulator(e,f.n.Horizontal),l=this._setupMeasureTypeManipulator(e,f.n.Vertical),c=new Ae({start:t,end:i,offset:n,heading:s,rotation:r,direct:o,horizontal:a,vertical:l});this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values())}_removeComputation(e){const t=this._computationManipulators.get(e);if(!(0,c.Wi)(t)){this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of t.values())this.manipulators.remove(e)}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,d.YP)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...d.tX,equals:$e.fS})],e)}_setupPointManipulator(e,t){const{view:i}=this,{dimension:n}=e,s=function(e,t){const i=(0,Ce.aD)(e,ae.Z.toUnitRGB(Se.pointManipulators.color),Se.pointManipulators.opacity,Ye);return i.available=!1,i.grabCursor="crosshair",i.radius=Se.pointManipulators.radius,i.metadata=t.metadata,i.collisionPriority=1,i}(i,{metadata:n}),r=function(e,{isStart:t,createSnappingPipelineStep:i,dimension:n,onUpdate:s,snappingPipeline:r,view:o}){const a=t?"startPoint":"endPoint",l=(0,Me.Xd)(e,((e,t,l,c)=>{const d=(0,Pe.J4)(e);l=l.next(d).next((0,Me.di)(n,[a,"measureType","orientation"])),t.next(d).next((0,Pe.gv)(o)).next(i(l,c),r.next).next((e=>{const t=(0,M.WG)(e.mapEnd,new De.Z);s("startPoint"===a?{startPoint:t}:{endPoint:t})}))}));return[l]}(s,{isStart:t.isStart,createSnappingPipelineStep:(e,t)=>this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(t),snappingManager:this._snappingManager,updatingHandles:this.updatingHandles,cancel:e}),dimension:n,onUpdate:t=>{this._applyPointUpdate(e,t)},snappingPipeline:this._snappingPipeline,view:i});return this._computationHandles.add(r,e),s}_setupOffsetManipulator(e){const{view:t}=this,i=function(e,t){const i=[(0,C.f)(-.5,0,0),(0,C.f)(.5,0,0)],{lengthFraction:n}=Se.offsetManipulator,s=(0,be.rh)(i.map((e=>(0,w.g)((0,C.c)(),e,n))));return new we.Z({view:e,renderObjects:[{geometry:s,material:t.unfocusedMaterial,stateMask:Ee.Q9.Unfocused|Ee.Q9.Selected|Ye},{geometry:s,material:t.focusedMaterial,stateMask:Ee.Q9.Focused|Ye}],collisionType:{type:"line",paths:[i]},radius:je(t.lineSizePt)/2,metadata:t.metadata,available:!1,...Ce.X9})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),n=function(e,{computation:t,view:i}){return[(0,Me.Xd)(e,((e,n,s)=>{if(!ne(t)||!e.selected)return;const{geometry:r,dimension:o}=t,a=(0,Pe.J4)(e);n.next(a).next(ze(i,o,r.dimensionSegment,r.primaryOffsetAxis)),s.next(a).next((0,Me.di)(o,["offset"]))}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupHeadingManipulator(e){const{view:t}=this,i=Oe(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=function(e,{computation:t,view:i}){return[(0,Me.Xd)(e,((e,n,s)=>{Le({cancel:s,computation:t,settingHeading:!0,steps:n,view:i})}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupRotationManipulator(e){const{view:t}=this,i=Oe(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=function(e,{computation:t,view:i}){return[(0,Me.Xd)(e,((e,n,s)=>{Le({cancel:s,computation:t,settingHeading:!1,steps:n,view:i})})),e.events.on("immediate-click",(e=>{!function(e,t,i){const{dimension:n,geometry:s}=t;if(90===n.orientation||270===n.orientation)return n.orientation=0,void e.stopPropagation();if((0,c.Wi)(s))return;const{renderCoordsHelper:r}=i,o=V({...k(t),orientation:90},r),a=V({...k(t),orientation:270},r);if((0,c.Wi)(o)||(0,c.Wi)(a))return;const l=$(o,r),d=$(a,r),h=He(s,i),u=le.BV.shortestSignedDiff(h,l),p=le.BV.shortestSignedDiff(h,d);n.orientation=Math.abs(u)<Math.abs(p)?90:270,e.stopPropagation()}(e,t,i)}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupMeasureTypeManipulator(e,t){const{view:i}=this,n=function(e,t){const i=[(0,C.f)(-.5,0,0),(0,C.f)(.5,0,0)],{lengthFraction:n}=Se.offsetManipulator,s=(0,be.rh)(i),r=(0,be.rh)(i.map((e=>(0,w.g)((0,C.c)(),e,n))));return new we.Z({view:e,renderObjects:[{geometry:r,material:t.unfocusedMaterial,stateMask:Ee.Q9.Unfocused|Ye},{geometry:r,material:t.focusedMaterial,stateMask:Ee.Q9.Focused|Ye},{geometry:s,material:t.thinOffsetManipulatorMaterial,stateMask:Ye}],collisionType:{type:"line",paths:[i]},radius:je(t.lineSizePt)/2,available:!1,metadata:t.metadata,...Ce.X9})}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),s=function(e,{computation:t,manipulatorMeasureType:i,view:n}){let s=f.n.Direct,r=0,o=0;return[e.events.on("grab-changed",(a=>{if("start"!==a.action||!ne(t))return;const{dimension:l,geometry:c}=t;s=l.measureType,r=l.offset,o=l.orientation;const d=(0,w.c)(x.WM.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,i,n){const{directSegment:s}=i,r=X(x.WM.get(),{measureType:t,directSegment:s,renderCoordsHelper:n}),o=B(Y,{offsetAxis:r,offset:0,relativeToSegment:s,renderCoordsHelper:n}).eval(.5,x.WM.get()),a=(0,w.y)(x.WM.get(),e,o);return(0,w.e)(a,r)*n.unitInMeters}(d,i,c,n.renderCoordsHelper),l.orientation=0})),(0,Me.Xd)(e,((e,a,l)=>{if(!ne(t))return;const{geometry:c,dimension:d}=t,{renderCoordsHelper:h}=n,u=F(Be,i,t,h),p=X(x.WM.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:h}),f=(0,Pe.J4)(e);a.next(f).next(ze(n,d,u,p)),l.next(f).next((e=>(d.measureType=s,d.offset=r,d.orientation=o,e)))}))]}(n,{computation:e,manipulatorMeasureType:t,view:i});return this._computationHandles.add(s,e),n}_updateManipulators(e,t,i={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:r}=i,{start:o,end:a,offset:l,heading:d,rotation:h}=t,u=s===e,p=ne(e),{dimension:g}=e;for(const e of t.values()){const t=p&&(0,c.Wi)(n)&&((0,c.Wi)(r)||e===r);e===l?(e.available=t,e.selected=u):e.available=t&&u}if(!p)return;(0,c.pC)(tt(e,this.view))?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(g.measureType).available=!1;for(const e of[d,h])g.measureType===f.n.Direct&&0!==g.offset||(e.available=!1);U(e)?h.available=!1:d.available=!1;const{geometry:m}=e;o.renderLocation=m.directSegment.startRenderSpace,a.renderLocation=m.directSegment.endRenderSpace;const{renderCoordsHelper:_}=this.view;Ze(l,m,_),d.available&&function(e,t,i){ke(e,t,i,{forHeading:!0})}(d,e,_),h.available&&function(e,t,i){ke(e,t,i,{forHeading:!1})}(h,e,_),t.forEachMeasureTypeManipulator(((t,i)=>{t.available&&function(e,t,i,n){const{geometry:s}=t,r=F(Be,i,t,n),o=X(Xe,{measureType:i,directSegment:s.directSegment,renderCoordsHelper:n}),a=(0,w.y)(qe,r.endRenderSpace,r.startRenderSpace),l=(0,Ce.Aq)(a,o,C.Z,Ue),c=(0,w.l)(a);(0,v.k)(l,l,(0,w.s)(qe,c,c,c)),e.modelTransform=l,e.renderLocation=r.eval(.5,qe)}(t,e,i,_)}))}_updateManipulatorStyle(e){const t=function(e){return(0,ce.F2)(e)+Se.offsetManipulator.linePaddingPx}(e),i=je(e),n={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:e,heading:t,rotation:s}of this._computationManipulators.values())e.radius=i/2,Re(t,n),Re(s,n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_snappingContext(e){return new Mn({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new Pi.c(new Ci.XE("point",(0,wi.Y6)(!0,!1,this.view.spatialReference))),visualizer:new Nt})}_applyPointUpdate(e,t){const{view:i}=this,n=k(e);"startPoint"in t&&(n.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(n.elevationAlignedEndPoint=t.endPoint);const s=V(n,i.renderCoordsHelper);if((0,c.Wi)(s))return;const r=tt({...n,geometry:s},i);(function(e,t,i){const{constraint:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,unconstrainedGeometry:o,view:a}=i,{dimension:l,previousConstraint:d,preConstraintProperties:h}=e;if((0,c.Wi)(s)||(0,c.Wi)(r))return;const u=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if((0,c.Wi)(n))u(),(0,c.pC)(d)&&(0,c.pC)(h)&&(l.measureType=h.measureType,l.orientation=h.orientation);else switch(l.measureType=f.n.Direct,n){case Qe.Horizontal:if(n!==d&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;(0,c.pC)(e)&&(e.z=r.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;(0,c.pC)(e)&&(e.z=s.z),l.endPoint=e}break;case Qe.Vertical:if(n!==d&&(l.orientation=He(o,a)),"startPoint"in t){const e=t.startPoint;(0,c.pC)(e)&&(e.x=r.x,e.y=r.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;(0,c.pC)(e)&&(e.x=s.x,e.y=s.y),l.endPoint=e}break;case Qe.Direct:n!==d&&(0,c.pC)(h)&&(l.orientation=h.orientation),u()}e.previousConstraint=n})(e,t,{...n,constraint:r,unconstrainedGeometry:s,view:i}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if((0,c.Wi)(e.geometry))return;e.geometry.directSegment.eval(.5,Ln);const t=this.view.state.camera.computeRenderPixelSizeAt(Ln);e.dimension.offset=Se.initialOffsetPx*t}get testInfo(){const e=e=>this.analysisViewData.computations.find((t=>t.dimension===e));return{getManipulatorsForDimension:t=>this._computationManipulators.get(e(t)),getComputationForDimension:t=>e(t),getConstraintForDimension:t=>{const i=e(t);return(0,c.pC)(i)?tt(i,this.view):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};function Rn(){const{color:e,opacity:t}=Se.offsetManipulator;return new pt.U({color:[...ae.Z.toUnitRGB(e),t],width:1,renderOccluded:ht.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}(0,r._)([(0,h.Cb)({constructOnly:!0})],On.prototype,"analysis",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],On.prototype,"analysisViewData",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],On.prototype,"manipulators",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],On.prototype,"parentTool",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],On.prototype,"view",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],On.prototype,"updating",null),(0,r._)([(0,h.Cb)()],On.prototype,"firstGrabbedManipulator",null),(0,r._)([(0,h.Cb)()],On.prototype,"hasGrabbedManipulators",null),(0,r._)([(0,h.Cb)()],On.prototype,"_stagedDimension",void 0),(0,r._)([(0,h.Cb)()],On.prototype,"_activeComputation",null),(0,r._)([(0,h.Cb)()],On.prototype,"_stagedComputation",null),On=(0,r._)([(0,u.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],On);const Ln=(0,C.c)();var zn=i(8927),Hn=i(20757),Zn=i(53203);const kn={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};var Vn,In=i(38114);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Vn||(Vn={}));let Gn=class extends Zn.f{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=Se.pointerMoveTimeoutMs,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,zn.Z8)(this.view.state.viewingMode),this._intersector.options.store=Hn.eC.MIN,this._lengthDimensionSubTool=new On({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,oe.ed)(this._lengthDimensionSubTool),(0,oe.kB)((()=>this._clearPointerMoveTimeout())),(0,d.YP)((()=>this.state),(e=>{e===Vn.Created&&this.finishToolCreation()}),d.tX),(0,d.gx)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),d.tX),(0,d.YP)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),d.tX)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?(0,c.pC)(this._activeSubTool)?Vn.Creating:Vn.Created:Vn.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(kn.cancel===e.key){if((0,c.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else kn.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){(0,c.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if((0,c.Wi)(this._activeSubTool))return;const t=this._intersectScreen(e);(0,c.Wi)(t)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),(0,c.Wi)(this._activeSubTool))return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);(0,c.Wi)(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){(0,c.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,In.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const i=this._intersector.results.min,n=x.WM.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference):null}_removeSelected(){(0,c.pC)(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,c.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>{e.manipulator.state|=Ye})),this._prevPointerMoveTimeout=re.m.setTimeout((()=>{this.manipulators.forEach((e=>{e.manipulator.state&=~Ye}))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:e=>{this._pointerMoveTimerMs=e,this._resetPointerMoveTimeout()}}}};(0,r._)([(0,h.Cb)({constructOnly:!0})],Gn.prototype,"view",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],Gn.prototype,"analysis",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],Gn.prototype,"state",null),(0,r._)([(0,h.Cb)({readOnly:!0})],Gn.prototype,"updating",null),(0,r._)([(0,h.Cb)({readOnly:!0})],Gn.prototype,"cursor",null),(0,r._)([(0,h.Cb)({constructOnly:!0})],Gn.prototype,"analysisViewData",void 0),(0,r._)([(0,h.Cb)()],Gn.prototype,"selectedDimension",null),(0,r._)([(0,h.Cb)()],Gn.prototype,"automaticManipulatorSelection",void 0),(0,r._)([(0,h.Cb)()],Gn.prototype,"_activeSubTool",void 0),(0,r._)([(0,h.Cb)()],Gn.prototype,"_lengthDimensionSubTool",void 0),Gn=(0,r._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionTool")],Gn),i(87090);var Wn=i(10145),Fn=i(6941),Nn=i(24370),jn=i(84982);class Yn extends dt._{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=ht.yD.OccludeAndTransparent,this._width=1,this._color=(0,st.f)(1,0,1,1),this._placement="end",this._textureId=null,this._material=t,this._hasExternalMaterial=(0,c.pC)(t),this.applyProps(e)}setGeometryFromSegment(e,t){const i=e.endRenderSpace;this.transform=(0,v.f)(Xn,i),this._normal=t;const{points:n}=e.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){return(0,c.pC)(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,(0,c.pC)(this._material)&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return(0,c.pC)(this._material)?this._material.parameters.width:this._width}set width(e){this._width=e,(0,c.pC)(this._material)&&this._material.setParameters({width:e})}get color(){return(0,c.pC)(this._material)?this._material.parameters.color:this._color}set color(e){this._color=(0,st.a)(e),(0,c.pC)(this._material)&&this._material.setParameters({color:this._color})}get placement(){return(0,c.pC)(this._material)?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,(0,c.pC)(this._material)&&this._material.setParameters({placement:this._placement})}get textureId(){return(0,c.pC)(this._material)?this._material.parameters.textureId:this._textureId}set textureId(e){this._textureId=e,(0,c.pC)(this._material)&&this._material.setParameters({textureId:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new jn.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,Nn.c0)(this.geometry,this.normal)){const i=(0,Nn.YU)(t);e.addGeometry(i,(0,c.Wg)(this._material))}}forEachExternalMaterial(e){this._hasExternalMaterial||e((0,c.Wg)(this._material))}}const Xn=(0,S.c)();class qn{constructor(e){this.destroyed=!1,this._handles=new g.Z,this._messages=null,this._labelSegment=new E.y;const{analysis:t,computation:i,view:n,messages:s}=e;this.analysis=t,this.computation=i,this.view=n,this._messages=s;const r=e.visible,o={view:n,attached:r},{fontSize:a,textColor:l,textBackgroundColor:h}=t.style;this._visualElements=new Jn({marker:new Yn(o,e.markerMaterial),dimension:new Yt.r(o,e.dimensionLineMaterial),startOffset:new Yt.r(o,e.offsetLineMaterial),endOffset:new Yt.r(o,e.offsetLineMaterial),dimensionSmall:new Yt.r(o,e.smallDimensionLineMaterial),startOffsetSmall:new Yt.r(o,e.smallOffsetLineMaterial),endOffsetSmall:new Yt.r(o,e.smallOffsetLineMaterial),label:new Fn.Kc({view:n,attached:r,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,ce.F2)(a),textColor:l.clone(),backgroundColor:h.clone()})}),this._handles.add([(0,d.YP)((()=>i.geometry),(e=>{this.updateCameraDependentElements(n.state.camera,e,t.style),(0,c.pC)(i.geometry)&&this._updateLines(i.geometry)}),{...d.nn,equals:$e.fS}),(0,d.YP)((()=>i.length),(e=>this._updateLabelContent(e)),d.nn)])}set visible(e){for(const t of this._visualElements.values())t.attached=e}destroy(){this.destroyed=!0,this._handles=(0,c.SC)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=I(Un,G.Start,e.directSegment,e.dimensionSegment),i=I(Bn,G.End,e.directSegment,e.dimensionSegment),n=this._visualElements;n.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),n.dimension.setGeometryFromSegment(e.dimensionSegment),n.startOffset.setGeometryFromSegment(t),n.endOffset.setGeometryFromSegment(i),n.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),n.startOffsetSmall.setGeometryFromSegment(t),n.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(e,t,i){const n=this._visualElements;if((0,c.Wi)(t)){for(const e of n.values())e.visible=!1;return}const s=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Qn)),r=function(e,t){return(0,w.p)(K(ee,e))/t**2}(t,s),o=r<((0,ce.F2)(i.lineSize)*Se.smallScreenLengthLineSizeFactor)**2,a=!o;n.marker.visible=a,n.dimension.visible=a,n.startOffset.visible=a,n.endOffset.visible=a,n.dimensionSmall.visible=o,n.startOffsetSmall.visible=o,n.endOffsetSmall.visible=o;const l=(0,ce.F2)(i.fontSize)*Se.labels.minScreenLengthFontSizeFactor,{label:d}=n;if(r<l**2)return void(d.visible=!1);d.visible=!0;const{dimensionSegment:h,primaryOffsetAxis:u}=t,{offset:p}=this.computation.dimension,f=(Math.sign(p)>=0?1:-1)*function(e){return 1.5*(0,ce.F2)(e.fontSize)+Se.labels.marginPx+(0,ce.F2)(e.lineSize/2)}(i)*s;(function(e,t,i,n){(0,w.z)(e.startRenderSpace,t.startRenderSpace,i,n),(0,w.z)(e.endRenderSpace,t.endRenderSpace,i,n)})(this._labelSegment,h,u,f),d.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,ce.F2)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;(0,c.Wi)(e)||(0,c.Wi)(this._messages)?t.text="":t.text=(0,Wn.VG)(this._messages,e,e.unit)}}const Un=new E.y,Bn=new E.y,Qn=(0,C.c)();class Jn{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Kn=i(39530);class $n{constructor(e,t){this._textures=e,this._textureRepository=t,this._texturesByPrimitive=new Map}acquire(e){if(!this._texturesByPrimitive.has(e)){const t=(0,xe.uM)(this._textures,e),i=new Kn.T(this._textureRepository,t.texture.id);return this._texturesByPrimitive.set(e,{result:t,reference:i}),t.texture}return this._texturesByPrimitive.get(e).result.texture}destroy(){this._texturesByPrimitive.forEach((({result:e,reference:t})=>{t.dispose(),e.release()})),this._texturesByPrimitive.clear()}}var es=i(60997),ts=i(8108),is=i(60720);let ns=class extends o.Z{constructor(e){super(e),this.loadingMessages=!1,this._messages=null,this._dimensionVisualizations=new Map,this._markerMaterial=new jn.X({width:1,anchor:es.i5.Tip,color:qt.Z,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:ht.yD.OccludeAndTransparent}),this._dimensionLineMaterial=new pt.U({width:1,color:qt.Z,renderOccluded:ht.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters}),this._offsetLineMaterial=new pt.U({width:1,color:qt.Z,renderOccluded:ht.yD.OccludeAndTransparent,stipplePattern:(0,Ut.z5)(5),stippleScaleWithLineWidth:!0}),this._smallDimensionLineMaterial=new pt.U({width:1,color:qt.Z,renderOccluded:ht.yD.OccludeAndTransparent}),this._smallOffsetLineMaterial=new pt.U({width:1,color:qt.Z,renderOccluded:ht.yD.OccludeAndTransparent,stipplePattern:(0,Ut.z5)(5),stippleScaleWithLineWidth:!0})}get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}initialize(){const{textures:e}=this.view.sharedSymbolResources;if((0,c.pC)(e)){const{textureRepository:t}=this.view._stage.renderView,i=new $n(e,t),n=i.acquire("triangle");this.addHandles((0,oe.kB)((()=>i.destroy()))),this._markerMaterial.setParameters({textureId:n.id})}for(const e of this._lineMaterials())this.view._stage.add(e),this.addHandles((0,oe.kB)((()=>{this.view._stage.remove(e),e.dispose()})));const{computations:t}=this.analysisViewData;for(const e of t)this._addComputation(e);this.addHandles([t.on("change",(({added:e,removed:t})=>{for(const e of t)this._removeComputation(e);for(const t of e)this._addComputation(t)})),(0,d.YP)((()=>ae.Z.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),d.tX),(0,d.YP)((()=>this.analysis.style.lineSize),(e=>{const t=(0,ce.F2)(e);this._markerMaterial.setParameters({width:t*Se.markers.lineSizeFraction}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const i=Math.max(t*Se.offsetLine.lineSizeFraction,1);this._offsetLineMaterial.setParameters({width:i})}),d.tX),(0,d.YP)((()=>({camera:this.view.state.camera,style:ss(this.analysis)})),(({camera:e,style:t})=>{for(const[i,n]of this._dimensionVisualizations)n.updateCameraDependentElements(e,i.geometry,t),n.updateLabelStyle(t)})),(0,d.YP)((()=>this.visible),(e=>{for(const t of this._dimensionVisualizations.values())t.visible=e}))]),this.addHandles([(0,ts.qe)((()=>this._updateMessageBundle())),(0,d.gx)((()=>!this.loadingMessages),(()=>{for(const e of this._dimensionVisualizations.values())e.updateUnitsMessages(this._messages)}),d.Z_)]),this._updateMessageBundle()}destroy(){this._dimensionVisualizations.forEach((e=>{e.destroy()})),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const e of this._lineMaterials())e.setParameters({renderOccluded:ht.yD.Occlude})}}}_addComputation(e){this._dimensionVisualizations.has(e)||this._dimensionVisualizations.set(e,new qn({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}_removeComputation(e){const t=this._dimensionVisualizations.get(e);(0,c.Wi)(t)||(t.destroy(),this._dimensionVisualizations.delete(e))}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,is.ME)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function ss(e){const{fontSize:t,lineSize:i,textColor:n,textBackgroundColor:s}=e.style;return{fontSize:t,lineSize:i,textBackgroundColor:s.clone(),textColor:n.clone()}}(0,r._)([(0,h.Cb)({constructOnly:!0})],ns.prototype,"analysisViewData",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],ns.prototype,"view",void 0),(0,r._)([(0,h.Cb)()],ns.prototype,"analysis",null),(0,r._)([(0,h.Cb)()],ns.prototype,"visible",null),(0,r._)([(0,h.Cb)()],ns.prototype,"loadingMessages",void 0),ns=(0,r._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],ns);let rs=class extends o.Z{constructor(e){super(e),this.dimension=null,this.length=null}};(0,r._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],rs.prototype,"dimension",void 0),(0,r._)([(0,h.Cb)()],rs.prototype,"length",void 0),rs=(0,r._)([(0,u.j)("esri.views.3d.analysis.LengthDimensionResult")],rs);const os=rs;let as=class extends o.Z{constructor(e){super(e),this.geometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...i}=e;return{result:new os({dimension:t}),...i}}initialize(){this.addHandles([(0,d.YP)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),d.tX),(0,d.YP)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),d.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,r._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],as.prototype,"result",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],as.prototype,"projectAndAlignPoint",void 0),(0,r._)([(0,h.Cb)()],as.prototype,"dimension",null),(0,r._)([(0,h.Cb)()],as.prototype,"length",null),(0,r._)([(0,h.Cb)()],as.prototype,"geometry",void 0),(0,r._)([(0,h.Cb)()],as.prototype,"elevationAlignedStartPoint",void 0),(0,r._)([(0,h.Cb)()],as.prototype,"elevationAlignedEndPoint",void 0),(0,r._)([(0,h.Cb)()],as.prototype,"preConstraintProperties",void 0),(0,r._)([(0,h.Cb)()],as.prototype,"previousConstraint",void 0),as=(0,r._)([(0,u.j)("esri.views.3d.analysis.LengthDimensionComputation")],as);var ls=i(28376),cs=i(76497);const ds=e=>{let t=class extends e{constructor(...e){super(...e),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new a.Z}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,r._)([(0,h.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,r._)([(0,h.Cb)()],t.prototype,"tool",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],t.prototype,"results",null),(0,r._)([(0,h.Cb)()],t.prototype,"selectedDimension",void 0),(0,r._)([(0,h.Cb)()],t.prototype,"interactive",void 0),(0,r._)([(0,h.Cb)()],t.prototype,"visible",void 0),t=(0,r._)([(0,u.j)("esri.views.analysis.DimensionAnalysisView")],t),t};let hs=class extends(ds((0,p.p)(o.Z))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.computations=new a.Z,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if((0,c.Wi)(e))return null;const{spatialReference:t,elevationProvider:i}=this.view,n=(0,ls.G)(e,t,i);return(0,c.Wi)(n)&&(0,ls.e)(this.analysis,e.spatialReference,l.Z.getLogger(this.declaredClass)),n},this.addHandles([(0,cs.Lp)(this,Gn),(0,d.on)((()=>this.analysis.dimensions),"after-add",(e=>this._onDimensionAdd(e.item)),{onListenerAdd:e=>{for(const t of e)this._onDimensionAdd(t)},onListenerRemove:()=>{this._onDimensionsClear()}}),(0,d.on)((()=>this.analysis.dimensions),"after-remove",(e=>this._onDimensionRemove(e.item)))]),this._analysisVisualization=new ns({analysisViewData:this,view:this.view}),this._analysisController=new se({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,c.IM)(this._placementTask),this._analysisVisualization=(0,c.SC)(this._analysisVisualization),(0,cs.Yq)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return(0,c.Wi)(e)?null:this._dimensionsToComputations.get(e)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,c.IM)(this._placementTask),this._placementTask=(0,cs.Er)(this,e),this._placementTask.promise}_onDimensionAdd(e){const{computations:t,_dimensionsToComputations:i}=this;if(i.has(e))return;const n=new as({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});t.add(n),i.set(e,n)}_onDimensionRemove(e){const{computations:t,_dimensionsToComputations:i}=this,n=t.findIndex((t=>t.dimension===e)),s=t.getItemAt(n);s.dimension===this.selectedDimension&&(this.selectedDimension=null),t.removeAt(n),i.delete(e),(0,c.SC)(s)}_onDimensionsClear(){this.computations.drain((e=>e.destroy())),this._dimensionsToComputations.clear()}};(0,r._)([(0,h.Cb)({readOnly:!0})],hs.prototype,"type",void 0),(0,r._)([(0,h.Cb)()],hs.prototype,"tool",void 0),(0,r._)([(0,h.Cb)()],hs.prototype,"updating",null),(0,r._)([(0,h.Cb)({readOnly:!0})],hs.prototype,"results",null),(0,r._)([(0,h.Cb)({readOnly:!0})],hs.prototype,"computations",void 0),(0,r._)([(0,h.Cb)()],hs.prototype,"selectedDimension",void 0),(0,r._)([(0,h.Cb)()],hs.prototype,"selectedComputation",null),(0,r._)([(0,h.Cb)()],hs.prototype,"_analysisVisualization",void 0),(0,r._)([(0,h.Cb)()],hs.prototype,"_analysisController",void 0),(0,r._)([(0,h.Cb)()],hs.prototype,"_dimensionsToComputations",void 0),(0,r._)([(0,h.Cb)()],hs.prototype,"_placementTask",void 0),hs=(0,r._)([(0,u.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],hs);const us=hs},28401:(e,t,i)=>{i.d(t,{O:()=>a,s:()=>l});const n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACtVBMVEUAAAD/AAD/gAD/VQD/gAD/gAD/bQD/gAD/cQD/gAD/dAD/gAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/fAD/gAD/gAD/fAD/gAD/fQD/fQD/gAD/fQD/egD/fQD/gAD/egD/fQD/gAD/ewD/gAD/ewD/gAD/ewD/fQD/fQD/gAD/ewD/fQD/gAD/fAD/gAD/fAD/fgD/gAD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fgD/fQD/fQD/fgD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fQD/fgD/gAL/fgD/gAb/gAT/gwr/hAz/hxH/hQ//iBX/iBP/ixn/iRf/jBr/jR7/jyP/jyL/kif/kCX/kyr/lS7/lCz/ljH/li//mTX/nDr/mjn/nTz/oEL/okf/o0r/pU3/pU7/qFL/plH/qFX/q1j/q1r/rl7/sGL/rmH/s2v/tW//tW7/t3L/uHL/unb/unf/vHv/vX3/v4D/vX7/v4D/wYT/v4L/wYX/x4//x5H/yZX/y5n/zZv/y5n/zJv/zZ3/zp//0aL/z6H/1Kr/1av/06r/1q//17H/2bT/2LP/2rb/27n/3bz/3r7/37//4MH/38D/4ML/4sX/4sb/4sf/48n/5cv/48r/5cz/5s7/6dT/6tb/69j/69n/7Nn/7dv/7dz/7t7/7t3/7+H/7+D/7+H/8eL/8uX/8uX/8ub/8+j/8+f/9On/9er/9Or/9ez/9e3/9ez/9u7/9e3/9+//9+7/+PD/+PH/+fT/+fL/+vb/+vX/+vb/+/f/+vb//Pn/+/j//Pr//Pn//fv//Pr//fv//v3//fz//////v7//v3///8ZYzD6AAAA5nRSTlMAAQIDBAYHCAkKCwwQERITGBkaGyUmKCkqKy0uLzAxMjIzNDQ2Njg4OTs+Pj9AQEJCQ0RERUZHUlJTVFVWWFlfYGFiY2RlZmdoaWprbG1ucHFyc3R1dnd4eXp8f4CAgYGCg4SEhYWGhoeIiYmKiouMjI2Nj5CQkZOUlZaXmJiZmpudnp6io6OkpaanqKmqqqusrK2xs7W2t7e4ubq7u7/AwMLExcXGyMrLzM3NztDR0tPU1NXW29zd3t/g4eLi5OTl5ufo6erq6+zs7e7u7+/w8PHy9PT29vf4+Pn5+vr7+/z9/f7+/pNrFTEAAAO8SURBVHjaldf5W1RVGAfwl4kGxa2yIDPbF82EJhkVUEOiUiDMcJa482XCijStNLLVpoWCbLHFaZUoMSkq2wgtW8mobFcryiiWkffv6J557jh3zj33zvD56f3h3vM873nP+z7nkJ3cPE9JxdX+OgSWX15aMG0CjcnUoiuRSls2byplyH1eDZSqZrkz+d0ThC1/QQ45c521Eo58p5GTSZcirbIpZGtGEBkI5pNaVhEyo3mzSCF7ITJW7CKLYxbDTsPG5qe33QezxdkkySqGndYY615CilI5Cy9sRVjYgVRzKcXJGmzdwsKHkEwnkylB2AsNse5zSIITKWkJnPzCut8gW5IsxRlw9CnrRuohO5MM43xw9D4Lt0JWm2jOOXD2Ogv3w6LQaGA/nL3AwuOwCLpJmIU0nmDheVidQ0IV0niAhQ5YVcfnH2zcCMNtLLwHheOJaB5s7OxuQlx4hHV7oeAhokrYaOeBjkYIv7LuJyhUEU3QYONFZj4YrQfwGeuGQrDSxtM0KK2N7h5koa8V+ICFdVA4SX2Kbt5xmA2j7SHsZGETFOZQqarwhzjhUAuAl1nYDIUFdAVkoe0s/LiLmT9eD91TLDwHhXJaDtmbrPvyEWzg4dfCEB5kYTsUrqIgJK8w8/C2MHDDgWYgromFXVDwkQbDRsRFhpkHWyHcBMO1oyzSgcI1VGdEd8V6o6uA8D7m2BZIDrJuPxTqKGBEnczc33nHFmZ+A7IvWDegTmEF4lb1s3Dk+wH+oxGyj1hYC6saqkDcVk74u6cJsk4W7oXVZVSCuK84aXTP5pBcGeFRWM2nQmMPOw+zyQ9t62DyLAtRWM2mPBgao1+zyVD3wyEkPMTCq7DKo/Gmdo50DbDJd22JbbudhXdgoeUSVcNkTfRbNvnv3U0QGmKs2w2LpUR0MVI1d4+wSW/0egC/i7APFkXKobq+7Wc2+avrHvSK4B/1UKUaWNQ/1nOEk2Kf7GdhNSTLSDgfKhvaDrDsbkhmkuAOQKnhmb2cqkVuBDfFeWDnzo4/2WQrUl2QuB7XwtZ1T+7ho9qRYmUOGc6Gk8hb/xoLvI0Up1KCqxyOVkf3sdADs0soaVIQaUS6Bpm/gUlgMplMR1pron39SNLyKcVcpBduCQMJXpLMx5gsdJEkexHGYJGLLFzFyFhJNilkeTVkxkM28oPIQOAUsjW5DGmVTSQnM3xwVHt6FjnLudAPW4GLMnq7zqyEUvW5x1KGTvAulSqiVRYeR2OSmz+7uKLGpwX8K8oXFJw4zu67/wFaspwc84wT2QAAAABJRU5ErkJggg==";var r=i(44101);const o={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function a(e){return e.fromData(n,(()=>new r.x(n,o)))}function l(e){return e.fromData(s,(()=>new r.x(s,o)))}},81536:(e,t,i)=>{i.d(t,{J4:()=>m,_N:()=>g,gv:()=>_});var n,s,r=i(61681),o=i(95550),a=(i(6766),i(8909)),l=(i(90472),i(69430)),c=i(97537),d=(i(5700),i(68817)),h=(i(83772),i(40460)),u=i(8927),p=i(20757),f=i(5073);function g(e,t){return function(e,t){const i=(0,a.c)(),n=(0,a.c)();let s=!1;return a=>{const c=t(a);if("start"===a.action){const t=(0,o.md)(a.screenStart,(0,o.c$)(d.qW.get())),n=(0,h.u4)(e.state.camera,t,y);(0,r.pC)(n)&&(s=(0,l.BR)(c,n,i))}if(!s)return null;const u=(0,o.md)(a.screenEnd,(0,o.c$)(d.qW.get())),p=(0,h.u4)(e.state.camera,u,y);return(0,r.Wi)(p)?null:(0,l.BR)(c,p,n)?{...a,renderStart:i,renderEnd:n,plane:c,ray:p}:null}}(e,(()=>t))}function m(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,r.pC)(t)&&(t.remove(),t=null)}return i}}function _(e,t=null){const i=(0,u.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=p.eC.MIN,i.options.hud=!1;const s=(0,o.s1)(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=(0,a.c)(),d=(0,r.Pt)(t,e.spatialReference),h=t=>{e.map.ground&&e.map.ground.opacity<1?l.exclude.add(f.cy):l.exclude.delete(f.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,o.md)(t,s),i,l);const r=i.results.min;let a;if(r.getIntersectionPoint(c))a=r.intersector===p.q7.TERRAIN?n.GROUND:n.OTHER;else{if(!i.results.ground.getIntersectionPoint(c))return null;a=n.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(c,d),surfaceType:a}};let g;return e=>{if("start"===e.action){const t=h(e.screenStart);g=(0,r.pC)(t)?t.location:null}if((0,r.Wi)(g))return null;const t=h(e.screenEnd);return(0,r.pC)(t)&&(0,r.pC)(t.location)?{...e,mapStart:g,mapEnd:t.location,surfaceType:t.surfaceType}:null}}i(34108),(s=n||(n={}))[s.GROUND=0]="GROUND",s[s.OTHER=1]="OTHER",(0,a.c)(),(0,a.c)();const y=(0,c.Ue)()},83061:(e,t,i)=>{i.d(t,{R:()=>S});var n=i(44584),s=i(61681),r=i(76868),o=i(24455),a=i(39100),l=i(6766),c=i(8909),d=i(88589),h=i(18916),u=i(68817),p=i(10449),f=i(47562),g=i(6087),m=i(7358),_=i(21414),y=i(84891),v=i(65392);class S extends p._{constructor(e){super(e),this._handles=new n.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,c.c)(),this._up=(0,c.c)(),this._right=(0,c.c)(),this._renderOccluded=m.yD.OccludeAndTransparent,this._color=(0,h.f)(1,0,0,1),this._outlineColor=(0,h.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=m.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,d.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,d.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,l.i)(t,e),(0,l.i)(t,i))/3,(0,l.n)(this._up,(0,l.b)(this._up,e,t)),(0,l.n)(this._right,(0,l.b)(this._right,i,t)),(0,l.c)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new y.E(this._quadMaterialParameters),this._outlineMaterial=new v.U(this._outlineMaterialParameters),this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){(0,l.k)(this._up,c.Z)&&(0,l.k)(this._right,c.Z)||(this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e))}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,l.a)(u.WM.get(),this._up,this._right),i=(0,g.rh)([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,o.f)(w,this._position),(0,o.k)(w,w,[n,n,n]),(0,s.pC)(e)&&(e.transformation=w)}_quadGeometryData(e,t){const i=(0,l.a)(u.WM.get(),e,t);return new f.Z([[_.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[_.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this._outlineMaterialParameters)}}const w=(0,a.c)()},39530:(e,t,i)=>{i.d(t,{T:()=>r});var n=i(61681),s=i(78668);class r{constructor(e,t){this._textureRep=e,this._disposed=!1;const i=this._textureRep.acquire(t);(0,s.y8)(i)?(i.then((e=>{this._disposed?(0,n.RY)(e):this._textureRef=e})),this.loadPromise=i):this._textureRef=i}dispose(){this._textureRef=(0,n.RY)(this._textureRef),this._disposed=!0}get glTexture(){return(0,n.pC)(this._textureRef)?this._textureRef.glTexture:null}}},50639:(e,t,i)=>{i.d(t,{c:()=>d});var n=i(36663),s=i(30936),r=i(82064),o=i(81977),a=i(40266);let l=class extends r.wq{constructor(){super(...arguments),this.enabled=!0}};(0,n._)([(0,o.Cb)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,n._)([(0,a.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let c=class extends r.wq{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new s.Z([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"lineSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"parallelLineSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleTriangleSnapper",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"shortLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"distance",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"intersectionParallelLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"parallelLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"touchSensitivityMultiplier",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointOnLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:s.Z,nonNullable:!0})],c.prototype,"orange",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthReference",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthTarget",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"lineHintFadedExtensions",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"parallelLineHintWidth",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],c.prototype,"parallelLineHintLength",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"parallelLineHintOffset",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],c.prototype,"rightAngleHintSize",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],c.prototype,"rightAngleHintOutlineSize",void 0),c=(0,n._)([(0,a.j)("esri.views.interactive.snapping.Settings.Defaults")],c);const d=new c},45666:(e,t,i)=>{i.d(t,{Bq:()=>m,Hk:()=>p,M8:()=>C,UL:()=>y,aU:()=>S,jg:()=>w,ku:()=>g});var n=i(61681),s=i(55709),r=i(69666),o=i(6766),a=i(8909),l=i(50639),c=i(22519),d=i(6271),h=i(23440);class u{constructor(e){this.coordinateHelper=e}intersect(e){return function(e,t){let i=[];if(b(e)){const{pointXYZ:n}=e;M(t)?i=(0,d.pk)(t.lineLike,n):E(t)?i=(0,d.l0)(t.centerXYZ,t.radius,n):D(t)?i=(0,d.hm)(t.planeLike,n):A(t)&&(i=x(t,e))}else if(M(e)){const{lineLike:n}=e;b(t)?i=(0,d.pk)(n,t.pointXYZ):M(t)?i=(0,d.Lh)(n,t.lineLike):E(t)?i=(0,d.UG)(n,t.centerXYZ,t.radius):D(t)?i=(0,d.fK)(t.planeLike,n):A(t)&&(i=x(t,e))}else if(E(e)){const{centerXYZ:n,radius:s}=e;M(t)?i=(0,d.UG)(t.lineLike,n,s):b(t)?i=(0,d.l0)(n,s,t.pointXYZ):D(t)?i=(0,d._w)(t.planeLike,n,s):A(t)&&(i=x(t,e))}else if(D(e)){const{planeLike:n,coordinateHelper:s}=e;if(D(t))return(0,d.qi)(n,t.planeLike).map((i=>new _(s,s.fromXYZ(i),e,t)));b(t)?i=(0,d.hm)(n,t.pointXYZ):M(t)?i=(0,d.fK)(n,t.lineLike):E(t)?i=(0,d._w)(n,t.centerXYZ,t.radius):A(t)&&(i=x(t,e))}else A(e)&&(i=x(e,t));return function(e,t,i){const n=t.coordinateHelper;return e.map((e=>new m(n,n.fromXYZ(e),t,i)))}(i,e,t)}(this,e)}}class p extends u{constructor(e,t){super(e),this.point=t,this.pointXYZ=e.toXYZ(t)}equals(e){return b(e)&&(0,c.Xv)(this.point,e.point)}check(e){const t=this.coordinateHelper.toXYZ(e,T);return(0,o.d)(t,this.pointXYZ)<l.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}}class f extends u{constructor(e,t,i,n){super(e),this.start=t,this.end=i,this.type=n,this.startXYZ=e.toXYZ(t),this.endXYZ=e.toXYZ(i),this.lineLike={start:this.startXYZ,end:this.endXYZ,type:this.type}}equals(e){return M(e)&&this.type===e.type&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)}check(e){const t=this.coordinateHelper.toXYZ(e,T);return(0,d.Mm)(this.lineLike,t)<l.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,T),n=(0,d.ZE)(i,this.lineLike);return t.fromXYZ(n)}}class g extends f{constructor(e,t,i){super(e,t,i,h.SP.LINE)}}class m extends u{constructor(e,t,i,n){super(e),this.intersection=t,this.first=i,this.second=n}equals(e){return e instanceof m&&this.first.equals(e.first)&&this.second.equals(e.second)}check(){return!1}closestTo(){return this.coordinateHelper.clone(this.intersection)}}class _ extends u{constructor(e,t,i,n){super(e),this.basePoint=t,this.first=i,this.second=n}equals(e){return e instanceof _&&this.first.equals(e.first)&&this.second.equals(e.second)}check(){return!1}closestTo(e){const t=this.basePoint,i=this.coordinateHelper,n=i.toXYZ(e,T),s=(0,o.s)(O,t[0],t[1],n[2]);return i.fromXYZ(s)}}class y extends u{constructor(e,t,i){super(e),this.center=t,this.radius=i,this.centerXYZ=e.toXYZ(t)}equals(e){return E(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,T),n=(0,d.xO)(i,this.centerXYZ,this.radius);return n[2]=t.getZ(e,this.centerXYZ[2]),t.fromXYZ(n)}}class v extends u{constructor(e,t,i,n){super(e),this.start=t,this.end=i,this.type=n,this.planeLike={start:t,end:i,type:n}}equals(e){return D(e)&&this.type===e.type&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)}check(e){const t=this.coordinateHelper.toXYZ(e,T);return(0,d.xb)(t,this.planeLike)<l.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,T),n=(0,d.z9)(i,this.planeLike);return t.fromXYZ(n)}closestEndTo(e){const{start:t,end:i}=this;return Math.sign((0,s.h)((0,s.a)(R,i,t),(0,s.a)(L,e,t)))>0?i:t}}class S extends v{constructor(e,t,i){super(e,t,i,d.Jk.HALF_PLANE)}}class w extends v{constructor(e,t,i){super(e,t,i,d.Jk.PLANE)}}class C extends u{constructor(e,t,i,n){super(e),this.start=t,this.end=i,this.getZ=n,this.planeLike={start:t,end:i,type:d.Jk.HALF_PLANE}}equals(e){return A(e)&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)&&this.getZ===e.getZ}check(e){const t=this.coordinateHelper.toXYZ(e,T),i=P(this,t);return(0,o.d)(t,i)<l.c.pointThreshold}closestTo(e){const t=this.coordinateHelper,i=P(this,t.toXYZ(e,T));return t.fromXYZ(i)}addIfOnTheGround(e,t){for(const i of t){const t=this.getZ(i[0],i[1],i[2]);(0,n.pC)(t)&&Math.abs(i[2]-t)<d.Ho&&(i[2]=t,e.push(i))}}}function P(e,t){const i=(0,d.z9)(t,e.planeLike),s=e.getZ(t[0],t[1],t[2]);return(0,n.pC)(s)&&(i[2]=s),i}function x(e,t){const{planeLike:i,getZ:s}=e,r=[];if(b(t))e.addIfOnTheGround(r,(0,d.hm)(i,t.pointXYZ));else if(M(t))e.addIfOnTheGround(r,(0,d.fK)(i,t.lineLike));else if(E(t))e.addIfOnTheGround(r,(0,d._w)(i,t.centerXYZ,t.radius));else if(D(t)||A(t))for(const[e,o]of(0,d.qi)(i,t.planeLike)){const t=s(e,o,0);(0,n.pC)(t)&&r.push((0,a.f)(e,o,t))}return r}function b(e){return e instanceof p}function M(e){return e instanceof f}function E(e){return e instanceof y}function D(e){return e instanceof v}function A(e){return e instanceof C}const T=(0,a.c)(),O=(0,a.c)(),R=(0,r.a)(),L=(0,r.a)()},20999:(e,t,i)=>{var n;i.d(t,{B:()=>n}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(n||(n={}))},46455:(e,t,i)=>{i.d(t,{L:()=>a});var n=i(45666),s=i(22519),r=i(7062),o=i(65453);class a extends r.a{constructor(e){super({...e,constraint:new n.ku(e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(s.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}},7062:(e,t,i)=>{i.d(t,{a:()=>r});var n=i(20999),s=i(72461);class r extends s.j{constructor({coordinateHelper:e,targetPoint:t,objectId:i,constraint:s,elevationInfo:r}){super(e,t,s,r,n.B.FEATURE),this.objectId=i}}},72461:(e,t,i)=>{i.d(t,{j:()=>n});class n{constructor(e,t,i,n,s){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i,this.elevationInfo=n,this.domain=s}}},65453:(e,t,i)=>{i.d(t,{w:()=>o}),i(39994),i(13802);var n=i(20999),s=i(22519),r=i(9650);class o extends r.r{constructor(e,t,i,s,r=n.B.ALL,o=!0,a=!0){super(s,r),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,s.Xv)(this.lineStart,e.lineStart)&&(0,s.Xv)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}},82366:(e,t,i)=>{i.d(t,{n:()=>r});var n=i(22519),s=i(9650);class r extends s.r{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof r&&(0,n.Xv)(this.point,e.point)}}},9650:(e,t,i)=>{i.d(t,{r:()=>n});class n{constructor(e,t){this.elevationInfo=e,this.domain=t}}},22519:(e,t,i)=>{i.d(t,{Bb:()=>l,ML:()=>y,Xv:()=>a,Z_:()=>m,_j:()=>_,fG:()=>c,lQ:()=>d,rh:()=>g,ze:()=>p});var n=i(61681),s=i(6766),r=i(8909),o=i(83772);function a(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[2]===t[2]&&e[3]===t[3]}return!1}function l(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function c(e,t){return Math.sqrt(l(e,t))}function d(e,t,i){const n=i.toXYZ(e,h);t.sort(((e,t)=>{const r=i.toXYZ(e.targetPoint,u),o=(0,s.d)(r,n),a=i.toXYZ(t.targetPoint,u);return o-(0,s.d)(a,n)}))}const h=(0,r.c)(),u=(0,r.c)();var p,f;function g(e,t){return{point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),distance:e.distance,types:e.types,query:(0,n.pC)(t)?t.toJSON():{where:"1=1"}}}function m(e,t,i,s){const{coordinateHelper:r,elevationInfo:a}=i;if(!r.hasZ()||(0,n.Wi)(t)||"3d"!==t.type||(0,n.Wi)(e)||(0,o.BK)(a,s))return e;const l=(0,o.zx)(t,e,r.spatialReference,a,s),c=r.clone(e);return c[2]=l,c}function _(e,t,i,n=o.jG){return{left:m(e.leftVertex.pos,t,i,n),right:m(e.rightVertex.pos,t,i,n)}}function y(e){return e.createQuery()}(f=p||(p={}))[f.TARGET=0]="TARGET",f[f.REFERENCE=1]="REFERENCE",f[f.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"},6271:(e,t,i)=>{i.d(t,{Ho:()=>M,Jk:()=>n,Lh:()=>w,Mm:()=>v,UG:()=>S,ZE:()=>y,_w:()=>h,fK:()=>u,hm:()=>p,l0:()=>P,pk:()=>C,qi:()=>f,xO:()=>_,xb:()=>m,z9:()=>g});var n,s,r=i(19431),o=i(55709),a=i(69666),l=i(6766),c=i(8909),d=i(23440);function h({start:e,end:t,type:i},s,r){const a=[],l=s,d=(0,o.a)(E,t,e),h=(0,o.a)(D,e,l),u=(0,o.v)(d),p=2*(0,o.h)(d,h),f=p*p-4*u*((0,o.v)(h)-r*r);if(0===f){const t=-p/(2*u);(i===n.PLANE||t>=0)&&a.push((0,o.w)((0,c.f)(0,0,s[2]),e,d,t))}else if(f>0){const t=Math.sqrt(f),r=(-p+t)/(2*u);(i===n.PLANE||r>=0)&&a.push((0,o.w)((0,c.f)(0,0,s[2]),e,d,r));const l=(-p-t)/(2*u);(i===n.PLANE||l>=0)&&a.push((0,o.w)((0,c.f)(0,0,s[2]),e,d,l))}return a}function u(e,t){const i=e.start,s=e.end,r=(0,o.a)(E,s,i),a=(0,l.s)(D,-r[1],r[0],0),h=t.start,u=t.end,p=(0,l.y)(A,u,h),f=(0,l.e)(p,a),g=(0,l.s)(T,i[0],i[1],0),m=(0,l.y)(O,g,h),_=(0,l.e)(m,a);if(Math.abs(f)<M)return Math.abs(_),[];const y=(0,l.z)(R,h,p,_/f);if(t.type===d.SP.RAY){const e=(0,l.y)(L,y,h);if((0,l.e)(e,p)<-M)return[]}if(e.type===n.HALF_PLANE){const e=(0,o.e)(L,y,i);if((0,o.h)(e,r)<-M)return[]}return[(0,c.a)(y)]}function p(e,t){return C(x(z,t[2],e),t)}function f(e,t){const i=w(x(z,0,e),x(H,0,t)),n=[];for(const e of i)n.push((0,a.d)(e));return n}function g(e,t){return y(e,x(z,e[2],t))}function m(e,t){return v(x(z,e[2],t),e)}function _(e,t,i){const n=(0,l.s)(E,e[0],e[1],t[2]),s=(0,l.b)(D,n,t),r=i/(0,l.l)(s);return(0,l.z)((0,c.c)(),t,s,r)}function y(e,{start:t,end:i,type:n}){const s=(0,l.y)(E,e,t),r=(0,l.y)(D,i,t),o=(0,l.e)(s,r)/(0,l.e)(r,r);return(0,l.z)((0,c.c)(),t,r,n===d.SP.RAY?Math.max(o,0):o)}function v({start:e,end:t,type:i},n){const s=(0,l.y)(E,n,e),r=(0,l.y)(D,t,e);if(i===d.SP.RAY&&(0,l.e)(r,s)<-M)return(0,l.i)(e,n);const o=(0,l.f)(A,r,s);return(0,l.u)(o)/(0,l.u)(r)}function S({start:e,end:t,type:i},n,s){const a=[];if((0,r.W8)(e[2],n[2],M)&&(0,r.W8)(t[2],n[2],M)){const r=e,l=n,h=(0,o.a)(E,t,r),u=(0,o.a)(D,r,l),p=(0,o.v)(h),f=2*(0,o.h)(h,u),g=f*f-4*p*((0,o.v)(u)-s*s);if(0===g){const e=-f/(2*p);(i===d.SP.LINE||e>=0)&&a.push((0,o.w)((0,c.f)(0,0,n[2]),r,h,e))}else if(g>0){const e=Math.sqrt(g),t=(-f+e)/(2*p);(i===d.SP.LINE||t>=0)&&a.push((0,o.w)((0,c.f)(0,0,n[2]),r,h,t));const s=(-f-e)/(2*p);(i===d.SP.LINE||s>=0)&&a.push((0,o.w)((0,c.f)(0,0,n[2]),r,h,s))}}else{const o=(0,l.y)(E,t,e);if((0,r.W8)(o[2],0,M))return a;const c=(n[2]-e[2])/o[2],h=(0,l.z)(D,e,o,c);if(i===d.SP.RAY){const t=(0,l.y)(A,h,e);if((0,l.e)(o,t)<-M)return a}for(const e of P(n,s,h))a.push(e)}return a}function w(e,t){const i=e.start,n=e.end,s=t.start,o=t.end,a=(0,l.y)(E,n,i),h=(0,l.y)(D,o,s),u=(0,l.y)(A,s,i),p=(0,l.f)(T,a,h),f=(0,l.e)(u,p);if(!(0,r.W8)(f,0,M))return[];const g=(0,l.D)(p);if((0,r.W8)(g,0,M))return[];const m=(0,l.f)(O,u,h),_=(0,l.e)(m,p)/g,y=(0,l.z)(R,i,a,_);if(e.type===d.SP.RAY){const e=(0,l.y)(L,y,i);if((0,l.e)(a,e)<-M)return[]}if(t.type===d.SP.RAY){const e=(0,l.y)(L,y,s);if((0,l.e)(h,e)<-M)return[]}return[(0,c.a)(y)]}function C({start:e,end:t,type:i},n){const s=(0,l.y)(E,n,e),r=(0,l.y)(D,t,e),o=(0,l.f)(A,r,s);if((0,l.D)(o)/(0,l.D)(r)<M)switch(i){case d.SP.LINE:return[(0,c.a)(n)];case d.SP.RAY:return(0,l.e)(r,s)<-M?[]:[(0,c.a)(n)]}return[]}function P(e,t,i){return(0,r.W8)(e[2],i[2],M)&&(0,r.W8)((0,l.d)(i,e),t*t,M)?[(0,c.a)(i)]:[]}function x(e,t,{start:i,end:n,type:s}){return(0,l.s)(e.start,i[0],i[1],t),(0,l.s)(e.end,n[0],n[1],t),e.type=b[s],e}(s=n||(n={}))[s.PLANE=0]="PLANE",s[s.HALF_PLANE=1]="HALF_PLANE";const b={[n.PLANE]:d.SP.LINE,[n.HALF_PLANE]:d.SP.RAY},M=1e-6,E=(0,c.c)(),D=(0,c.c)(),A=(0,c.c)(),T=(0,c.c)(),O=(0,c.c)(),R=(0,c.c)(),L=(0,c.c)(),z={start:(0,c.c)(),end:(0,c.c)(),type:d.SP.LINE},H={start:(0,c.c)(),end:(0,c.c)(),type:d.SP.LINE}}}]);