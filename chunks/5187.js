"use strict";(self.webpackChunkobstacle_component=self.webpackChunkobstacle_component||[]).push([[5187],{59468:(e,t,r)=>{function s(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function i(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,r=0;for(let s=0;s<e.length;s++){const i=e[s].size;"number"==typeof i&&(t+=i,r++)}return t/r}(e.stops):t}function o(e,t){if(!t)return e;const r=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:r,minSize:s}=t;return(i(r,e)+i(s,e))/2}));let s=0;const o=r.length;if(0===o)return e;for(let e=0;e<o;e++)s+=r[e];const a=Math.floor(s/o);return Math.max(a,e)}function a(e){const t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;const i="visualVariables"in t?o(r,t.visualVariables):r;if("simple"===t.type)return s(i,t.symbol);if("unique-value"===t.type){let e=i;return t.uniqueValueInfos?.forEach((t=>{e=s(e,t.symbol)})),e}if("class-breaks"===t.type){let e=i;return t.classBreakInfos.forEach((t=>{e=s(e,t.symbol)})),e}return"dot-density"===t.type||t.type,i}r.d(t,{k:()=>a})},85187:(e,t,r)=>{r.r(t),r.d(t,{default:()=>K});var s=r(36663),i=(r(13802),r(7283)),o=(r(7753),r(70375)),a=r(39994),n=r(40266),l=r(78306),p=(r(4905),r(86114)),u=r(61681),y=r(78668),c=r(76868),h=r(17321),d=r(81977),f=r(91772),m=r(68577),g=r(51599),b=r(24065),w=r(21586),x=r(59468),v=r(66341),_=r(29927),I=r(84238),C=r(84684),P=r(53736),F=r(93698);const E=e=>e.spatialReference.wkid||JSON.stringify(e.spatialReference);function R(e,t){const{dpi:r,gdbVersion:s,geometry:i,geometryPrecision:o,height:a,layerOption:n,mapExtent:l,maxAllowableOffset:p,returnFieldName:y,returnGeometry:c,returnUnformattedValues:h,returnZ:d,spatialReference:f,timeExtent:g,tolerance:b,width:x}=e.toJSON(),{dynamicLayers:v,layerDefs:_,layerIds:I}=function(e){const{mapExtent:t,floors:r,width:s,sublayers:i,layerIds:o,layerOption:a,gdbVersion:n}=e,l=i?.find((e=>null!=e.layer))?.layer?.serviceSublayers,p="popup"===a,y={},c=(0,m.yZ)({extent:t,width:s,spatialReference:t?.spatialReference}),h=[],d=e=>{const t=0===c,r=0===e.minScale||c<=e.minScale,s=0===e.maxScale||c>=e.maxScale;if(e.visible&&(t||r&&s))if(e.sublayers)e.sublayers.forEach(d);else{if(!1===o?.includes(e.id)||p&&(!e.popupTemplate||!e.popupEnabled))return;h.unshift(e)}};if(i?.forEach(d),i&&!h.length)y.layerIds=[];else{const e=(0,F.FN)(h,l,n),t=h.map((e=>{const t=(0,w.f)(r,e);return e.toExportImageJSON(t)}));if(e)y.dynamicLayers=JSON.stringify(t);else{if(i){let e=h.map((({id:e})=>e));o&&(e=e.filter((e=>o.includes(e)))),y.layerIds=e}else o?.length&&(y.layerIds=o);const e=function(e,t){const r=!!e?.length,s=t.filter((e=>null!=e.definitionExpression||r&&null!=e.floorInfo));return s.length?s.map((t=>{const r=(0,w.f)(e,t),s=(0,C._)(r,t.definitionExpression);return{id:t.id,definitionExpression:s}})):null}(r,h);if((0,u.pC)(e)&&e.length){const t={};for(const r of e)r.definitionExpression&&(t[r.id]=r.definitionExpression);Object.keys(t).length&&(y.layerDefs=JSON.stringify(t))}}}return y}(e),R=t&&(0,u.pC)(t.geometry)?t.geometry:null,S={geometryPrecision:o,maxAllowableOffset:p,returnFieldName:y,returnGeometry:c,returnUnformattedValues:h,returnZ:d,tolerance:b},j=R&&R.toJSON()||i;if(S.imageDisplay=`${x},${a},${r}`,s&&(S.gdbVersion=s),j&&(delete j.spatialReference,S.geometry=JSON.stringify(j),S.geometryType=(0,P.Ji)(j)),f?S.sr=f.wkid||JSON.stringify(f):j&&j.spatialReference?S.sr=E(j):l&&l.spatialReference&&(S.sr=E(l)),S.time=g?[g.start,g.end].join(","):null,l){const{xmin:e,ymin:t,xmax:r,ymax:s}=l;S.mapExtent=`${e},${t},${r},${s}`}return _&&(S.layerDefs=_),v&&!_&&(S.dynamicLayers=v),S.layers="popup"===n?"visible":n,I&&!v&&(S.layers+=`:${I.join(",")}`),S}var S,j=r(91957),N=r(37956),O=r(82064),M=r(14685);let G=S=class extends O.wq{constructor(e){super(e),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}static from(e){return(0,i.TJ)(S,e)}};(0,s._)([(0,d.Cb)({type:Number,json:{write:!0}})],G.prototype,"dpi",void 0),(0,s._)([(0,d.Cb)()],G.prototype,"floors",void 0),(0,s._)([(0,d.Cb)({type:String,json:{write:!0}})],G.prototype,"gdbVersion",void 0),(0,s._)([(0,d.Cb)({types:j.qM,json:{read:P.im,write:!0}})],G.prototype,"geometry",void 0),(0,s._)([(0,d.Cb)({type:Number,json:{write:!0}})],G.prototype,"geometryPrecision",void 0),(0,s._)([(0,d.Cb)({type:Number,json:{write:!0}})],G.prototype,"height",void 0),(0,s._)([(0,d.Cb)({type:[Number],json:{write:!0}})],G.prototype,"layerIds",void 0),(0,s._)([(0,d.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],G.prototype,"layerOption",void 0),(0,s._)([(0,d.Cb)({type:f.Z,json:{write:!0}})],G.prototype,"mapExtent",void 0),(0,s._)([(0,d.Cb)({type:Number,json:{write:!0}})],G.prototype,"maxAllowableOffset",void 0),(0,s._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],G.prototype,"returnFieldName",void 0),(0,s._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],G.prototype,"returnGeometry",void 0),(0,s._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],G.prototype,"returnM",void 0),(0,s._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],G.prototype,"returnUnformattedValues",void 0),(0,s._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],G.prototype,"returnZ",void 0),(0,s._)([(0,d.Cb)({type:M.Z,json:{write:!0}})],G.prototype,"spatialReference",void 0),(0,s._)([(0,d.Cb)()],G.prototype,"sublayers",void 0),(0,s._)([(0,d.Cb)({type:N.Z,json:{write:!0}})],G.prototype,"timeExtent",void 0),(0,s._)([(0,d.Cb)({type:Number,json:{write:!0}})],G.prototype,"tolerance",void 0),(0,s._)([(0,d.Cb)({type:Number,json:{write:!0}})],G.prototype,"width",void 0),G=S=(0,s._)([(0,n.j)("esri.rest.support.IdentifyParameters")],G);const V=G;var T=r(80085),Z=r(34248),k=r(39835),A=r(59659);let J=class extends O.wq{constructor(e){super(e),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(e,t){return T.Z.fromJSON({attributes:{...t.attributes},geometry:{...t.geometry}})}writeFeature(e,t){if(!e)return;const{attributes:r,geometry:s}=e;r&&(t.attributes={...r}),(0,u.pC)(s)&&(t.geometry=s.toJSON(),t.geometryType=A.P$.toJSON(s.type))}};(0,s._)([(0,d.Cb)({type:String,json:{write:!0}})],J.prototype,"displayFieldName",void 0),(0,s._)([(0,d.Cb)({type:T.Z})],J.prototype,"feature",void 0),(0,s._)([(0,Z.r)("feature",["attributes","geometry"])],J.prototype,"readFeature",null),(0,s._)([(0,k.c)("feature")],J.prototype,"writeFeature",null),(0,s._)([(0,d.Cb)({type:Number,json:{write:!0}})],J.prototype,"layerId",void 0),(0,s._)([(0,d.Cb)({type:String,json:{write:!0}})],J.prototype,"layerName",void 0),J=(0,s._)([(0,n.j)("esri.rest.support.IdentifyResult")],J);const L=J;function U(e){const t=e.data;return t.results=t.results||[],t.exceededTransferLimit=Boolean(t.exceededTransferLimit),t.results=t.results.map((e=>L.fromJSON(e))),t}var q=r(30879),z=r(94449),H=r(59439),$=r(1759);let Q=null;const D=e=>{let t=class extends e{constructor(){super(...arguments),this._featuresResolutions=new WeakMap,this.highlightGraphics=new z.J,this.updateHighlightedFeatures=(0,y.Ds)((async e=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(e).catch((()=>{})))}))}initialize(){this.exportImageParameters=new b.R({layer:this.layer}),this.handles.add([(0,c.on)((()=>this.highlightGraphics),"change",(e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e.added).catch((()=>{}))),this.updateHighlightedFeatures(this._highlightGeometriesResolution)}))])}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeatures(e,t){const{layer:r}=this;if(!e)throw new o.Z("mapimagelayer:fetchPopupFeatures","Nothing to fetch without area",{layer:r});const s=this.layer.capabilities?.operations?.supportsQuery??!0;if(!((this.layer.capabilities?.operations?.supportsIdentify??1)&&this.layer.version>=10.5||s))throw new o.Z("mapimagelayer:fetchPopupFeatures-not-supported","query operation is disabled for this service",{layer:r});return s?this._fetchPopupFeaturesUsingQueries(e,t):this._fetchPopupFeaturesUsingIdentify(e,t)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}async _updateHighlightedFeaturesSymbols(e){for(const t of e){const e="renderer"in t.sourceLayer&&t.sourceLayer.renderer;"geometryType"in t.sourceLayer&&"point"===t.sourceLayer.geometryType&&e&&"getSymbolAsync"in e&&e.getSymbolAsync(t).then((async s=>{let i="width"in s&&"height"in s&&null!=s.width&&null!=s.height?Math.max(s.width,s.height):"size"in s?s.size:null;const o="visualVariables"in e&&e.visualVariables?.find((e=>"size"===e.type));o&&(Q||(Q=(await Promise.resolve().then(r.bind(r,36496))).getSize),i=Q(o,t,{view:this.view.type,scale:this.view.scale,shape:"simple-marker"===s.type?s.style:null})),this.highlightGraphics.includes(t)&&(t.symbol=new $.Z({style:"square",size:i,xoffset:"xoffset"in s?s.xoffset:0,yoffset:"yoffset"in s?s.yoffset:0}),t.visible=!0,this.highlightGraphicUpdated(t,"symbol"))}))}}async _updateHighlightedFeaturesGeometries(e){this._highlightGeometriesResolution=e;const t=this.highlightGraphics;if(!t.length||!this.layer.capabilities.operations.supportsQuery)return;const r=this._getTargetResolution(e),s=new Map;for(const e of t)if(!this._featuresResolutions.has(e)||this._featuresResolutions.get(e)>r){const t=e.sourceLayer;(0,p.s1)(s,t,(()=>new Map)).set(e.getObjectId(),e)}const i=Array.from(s,(([e,t])=>{const s=e.createQuery();return s.objectIds=[...t.keys()],s.outFields=[e.objectIdField],s.returnGeometry=!0,s.maxAllowableOffset=r,s.outSpatialReference=this.view.spatialReference,e.queryFeatures(s)})),o=await Promise.all(i);if(!this.destroyed)for(const{features:e}of o)for(const t of e){const e=t.sourceLayer,i=s.get(e).get(t.getObjectId());i&&this.highlightGraphics.includes(i)&&(i.geometry=t.geometry,this.highlightGraphicUpdated(i,"geometry"),this._featuresResolutions.set(i,r))}}_getTargetResolution(e){const t=e*(0,h.c9)(this.view.spatialReference),r=t/16;return r<=10?0:e/t*r}async _fetchPopupFeaturesUsingIdentify(e,t){const r=await this._createIdentifyParameters(e,t);if((0,u.Wi)(r))return[];const{results:s}=await async function(e,t,r){const s=(o=t,t=V.from(o)).geometry?[t.geometry]:[],i=(0,I.en)(e);var o;return i.path+="/identify",(0,_.aX)(s).then((e=>{const s=R(t,{geometry:e&&e[0]}),o=(0,I.cv)({...i.query,f:"json",...s}),a=(0,I.lA)(o,r);return(0,v.default)(i.path,a).then(U).then((e=>function(e,t){if(!t?.length)return e;const r=new Map;t.forEach((function e(t){r.set(t.id,t),t.sublayers&&t.sublayers.forEach(e)}));for(const t of e.results)t.feature.sourceLayer=r.get(t.layerId);return e}(e,t.sublayers)))}))}(this.layer.parsedUrl,r);return s.map((e=>e.feature))}async _createIdentifyParameters(e,t){const{floors:r,spatialReference:s,scale:i}=this.view,o=(0,u.pC)(t)?t.event:null,n=await this._collectPopupProviders(this.layer.sublayers,i,t);if(!n.length)return null;await Promise.all(n.map((({sublayer:e})=>e.load().catch((()=>{})))));const l=Math.min((0,a.Z)("mapimagelayer-popup-identify-max-tolerance"),this.layer.allSublayers.reduce(((e,t)=>t.renderer?(0,x.k)({renderer:t.renderer,event:o}):e),2)),p=this.createFetchPopupFeaturesQueryGeometry(e,l),y=(0,m.dp)(i,s),c=Math.round(p.width/y),h=new f.Z({xmin:p.center.x-y*c,ymin:p.center.y-y*c,xmax:p.center.x+y*c,ymax:p.center.y+y*c,spatialReference:p.spatialReference});return new V({floors:r,gdbVersion:this.layer.gdbVersion,geometry:e,height:c,layerOption:"popup",mapExtent:h,returnGeometry:!0,spatialReference:s,sublayers:this.layer.sublayers,timeExtent:this.timeExtent,tolerance:l,width:c})}async _fetchPopupFeaturesUsingQueries(e,t){const r=await this._collectPopupProviders(this.layer.sublayers,this.view.scale,t),s=(0,u.pC)(t)?t.event:null,i=r.map((async({sublayer:t,popupTemplate:r})=>{await t.load().catch((()=>{}));const i=t.createQuery(),o=(0,x.k)({renderer:t.renderer,event:s}),a=this.createFetchPopupFeaturesQueryGeometry(e,o);if(i.geometry=a,i.outFields=await(0,H.e)(t,r),i.timeExtent=this.timeExtent,"floors"in this.view){const e=this.view?.floors?.clone(),r=(0,w.f)(e,t);(0,u.pC)(r)&&(i.where=i.where?`(${i.where}) AND (${r})`:r)}const n=this._getTargetResolution(a.width/o),l=await this._loadArcadeModules(r),p="point"===t.geometryType||l&&l.arcadeUtils.hasGeometryOperations(r);p||(i.maxAllowableOffset=n);const{features:y}=await t.queryFeatures(i),c=p?0:n;for(const e of y)this._featuresResolutions.set(e,c);return y}));return(await(0,y.as)(i)).reverse().reduce(((e,t)=>t.value?[...e,...t.value]:e),[]).filter((e=>null!=e))}async _collectPopupProviders(e,t,r){const s=[],i=async e=>{const o=0===e.minScale||t<=e.minScale,a=0===e.maxScale||t>=e.maxScale;if(e.visible&&o&&a)if(e.sublayers)e.sublayers.forEach(i);else if(e.popupEnabled){const t=(0,H.V)(e,{...r,defaultPopupTemplateEnabled:!1});(0,u.pC)(t)&&s.unshift({sublayer:e,popupTemplate:t})}},o=e.toArray().reverse().map(i);return await Promise.all(o),s}_loadArcadeModules(e){if(e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type)))return(0,q.LC)()}};return(0,s._)([(0,d.Cb)()],t.prototype,"highlightGraphics",void 0),(0,s._)([(0,d.Cb)()],t.prototype,"exportImageParameters",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,s._)([(0,d.Cb)()],t.prototype,"layer",void 0),(0,s._)([(0,d.Cb)()],t.prototype,"suspended",void 0),(0,s._)([(0,d.Cb)(g.qG)],t.prototype,"timeExtent",void 0),t=(0,s._)([(0,n.j)("esri.views.layers.MapImageLayerView")],t),t};var B=r(99621);let W=class extends(D(l.Z)){constructor(){super(...arguments),this.type="map-image-3d"}initialize(){this.updatingHandles.add((()=>this.exportImageVersion),(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}createFetchPopupFeaturesQueryGeometry(e,t){return(0,B.K)(e,t,this.view)}highlight(e){return{remove:()=>{}}}highlightGraphicUpdated(e,t){}getFetchOptions(){return{timeExtent:this.timeExtent}}};W=(0,s._)([(0,n.j)("esri.views.3d.layers.MapImageLayerView3D")],W);const K=W},59439:(e,t,r)=>{r.d(t,{V:()=>a,e:()=>o});var s=r(61681),i=r(14845);async function o(e,t=e.popupTemplate){if((0,s.Wi)(t))return[];const r=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:o}=t,{objectIdField:a,typeIdField:n,globalIdField:l,relationships:p}=e;if(r.includes("*"))return["*"];const u=o?await(0,i.CH)(e):[],y=(0,i.Q0)(e.fieldsIndex,[...r,...u]);return n&&y.push(n),y&&a&&e.fieldsIndex.has(a)&&!y.includes(a)&&y.push(a),y&&l&&e.fieldsIndex.has(l)&&!y.includes(l)&&y.push(l),p&&p.forEach((t=>{const{keyField:r}=t;y&&r&&e.fieldsIndex.has(r)&&!y.includes(r)&&y.push(r)})),y}function a(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},99621:(e,t,r)=>{r.d(t,{K:()=>a}),r(91957);var s=r(61681),i=r(17321),o=r(91772);function a(e,t,r,a=new o.Z){let n;if("2d"===r.type)n=t*r.resolution;else if("3d"===r.type){const o=r.overlayPixelSizeInMapUnits(e),a=r.basemapSpatialReference;n=(0,s.pC)(a)&&!a.equals(r.spatialReference)?(0,i.c9)(a)/(0,i.c9)(r.spatialReference):t*o}const l=e.x-n,p=e.y-n,u=e.x+n,y=e.y+n,{spatialReference:c}=r;return a.xmin=Math.min(l,u),a.ymin=Math.min(p,y),a.xmax=Math.max(l,u),a.ymax=Math.max(p,y),a.spatialReference=c,a}new o.Z}}]);